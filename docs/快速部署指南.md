# EchoCampus-Bot å¿«é€Ÿéƒ¨ç½²æŒ‡å—

> **æœ€åæ›´æ–°**ï¼š2026å¹´1æœˆ13æ—¥  
> **é…ç½®ç‰ˆæœ¬**ï¼šæ ‡å‡†åŒ–ç¯å¢ƒé…ç½®ä½“ç³» v2.0

---

## ğŸ“‹ éƒ¨ç½²æ–¹å¼

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼š

| éƒ¨ç½²æ–¹å¼ | Docker Compose é…ç½® | Spring Profile | é€‚ç”¨åœºæ™¯ |
|---------|-------------------|----------------|----------|
| æœ¬åœ°å¼€å‘ç¯å¢ƒ | `docker-compose.dev.yml` | `dev` | æœ¬åœ°å¼€å‘ã€è°ƒè¯•ã€æµ‹è¯• |
| ç”Ÿäº§ç¯å¢ƒ | `docker-compose.prod.yml` | `prod` | æœåŠ¡å™¨éƒ¨ç½²ã€æ­£å¼è¿è¡Œ |

---

## ğŸš€ æœ¬åœ°å¼€å‘ç¯å¢ƒéƒ¨ç½²

### å‰ç½®è¦æ±‚

- Docker Desktop (Windows/Mac) æˆ– Docker Engine (Linux)
- Docker Compose
- JDK 17
- Maven 3.6+
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜

### æ­¥éª¤1ï¼šé…ç½®ç¯å¢ƒå˜é‡å’Œéƒ¨ç½²ä¿¡æ¯

#### é…ç½®åº”ç”¨ç¯å¢ƒå˜é‡ï¼ˆå¿…éœ€ï¼‰

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…éœ€çš„APIå¯†é’¥
# Windows: notepad .env
# Linux/Mac: nano .env
```

**å¿…éœ€é…ç½®é¡¹**ï¼š
```bash
# é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°APIå¯†é’¥ï¼ˆè·å–åœ°å€ï¼šhttps://dashscope.console.aliyun.com/apiKeyï¼‰
ALIYUN_API_KEY=sk-xxxxxxxxxxxxx

# DeepSeek APIå¯†é’¥ï¼ˆè·å–åœ°å€ï¼šhttps://platform.deepseek.com/api_keysï¼‰
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxx

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your_very_long_and_secure_jwt_secret_key
```

#### é…ç½®éƒ¨ç½²ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼‰

```bash
# å¤åˆ¶éƒ¨ç½²é…ç½®æ¨¡æ¿
cp .deployment.env.example .deployment.env

# ç¼–è¾‘ .deployment.env æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®çš„éƒ¨ç½²ä¿¡æ¯
# Windows: notepad .deployment.env
# Linux/Mac: nano .deployment.env
```

**éƒ¨ç½²é…ç½®è¯´æ˜**ï¼š
- `.deployment.env` æ–‡ä»¶åŒ…å«é˜¿é‡Œäº‘é•œåƒä»“åº“å’ŒæœåŠ¡å™¨éƒ¨ç½²çš„æ•æ„Ÿä¿¡æ¯
- è¯¥æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä»…åœ¨éœ€è¦æ¨é€é•œåƒåˆ°é˜¿é‡Œäº‘æˆ–éƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶é…ç½®

### æ­¥éª¤2ï¼šæ„å»ºåç«¯åº”ç”¨

```bash
cd backend
mvn clean package -DskipTests
cd ..
```

### æ­¥éª¤3ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
docker-compose -f docker-compose.dev.yml up -d --build
```

### æ­¥éª¤4ï¼šéªŒè¯æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f echocampus-bot

# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8083/api/v1/health
```

### æ­¥éª¤5ï¼šè®¿é—®æœåŠ¡

- **åç«¯API**: http://localhost:8083/api
- **APIæ–‡æ¡£**: http://localhost:8083/api/doc.html
- **Milvusç®¡ç†ç•Œé¢**: http://localhost:8000

### å¸¸ç”¨å‘½ä»¤

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.dev.yml down

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.dev.yml restart

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f

# æ¸…ç†æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker-compose -f docker-compose.dev.yml down -v
```

---

## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šæœ¬åœ°æ„å»ºå¹¶æ¨é€åˆ°é•œåƒä»“åº“

#### æ­¥éª¤1ï¼šæœ¬åœ°æ„å»º

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# Mavenæ‰“åŒ…
mvn clean package -DskipTests

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# æ„å»ºDockeré•œåƒ
docker build -t echocampus-bot:latest ./backend
```

#### æ­¥éª¤2ï¼šæ¨é€åˆ°é•œåƒä»“åº“

**é˜¿é‡Œäº‘é•œåƒä»“åº“ç¤ºä¾‹**ï¼š

```bash
# 1. ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
docker login --username=<é˜¿é‡Œäº‘ç”¨æˆ·å> <é•œåƒä»“åº“åœ°å€>

# 2. æ ‡è®°é•œåƒ
docker tag echocampus:latest <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest

# 3. æ¨é€é•œåƒ
docker push <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest
```

**æç¤º**ï¼š
- çœŸå®çš„é˜¿é‡Œäº‘ç”¨æˆ·åå’Œé•œåƒä»“åº“åœ°å€è¯·é…ç½®åœ¨ `.deployment.env` æ–‡ä»¶ä¸­
- é¦–æ¬¡ä½¿ç”¨éœ€è¦è¾“å…¥é˜¿é‡Œäº‘é•œåƒä»“åº“å¯†ç 

#### æ­¥éª¤3ï¼šæœåŠ¡å™¨éƒ¨ç½²

```bash
# è¿æ¥æœåŠ¡å™¨
ssh <ç”¨æˆ·å>@<æœåŠ¡å™¨IP>

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/<ç”¨æˆ·å>/docker-projects

# é…ç½®ç¯å¢ƒå˜é‡
nano .env
```

**ç”Ÿäº§ç¯å¢ƒå¿…å¡«é…ç½®**ï¼š

```bash
# æ•°æ®åº“é…ç½®ï¼ˆå¿…é¡»ä½¿ç”¨å¼ºå¯†ç ï¼‰
POSTGRES_DB=echocampus_bot
POSTGRES_USER=postgres
POSTGRES_PASSWORD=<your-strong-password>

# APIå¯†é’¥
ALIYUN_API_KEY=<your-aliyun-api-key>
DEEPSEEK_API_KEY=<your-deepseek-api-key>

# JWTå¯†é’¥ï¼ˆå¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=<your-strong-jwt-secret>

# é‚®ä»¶é…ç½®
MAIL_USERNAME=<your-email@163.com>
MAIL_PASSWORD=<your-email-authorization-code>

# CORSé…ç½®ï¼ˆå‰ç«¯åŸŸåï¼‰
CORS_ALLOWED_ORIGINS=http://<æœåŠ¡å™¨IP>

# Dockeré•œåƒåœ°å€
DOCKER_IMAGE=<é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest
```

#### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡

```bash
# ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
docker login --username=<é˜¿é‡Œäº‘ç”¨æˆ·å> <é•œåƒä»“åº“åœ°å€>

# æ‹‰å–é•œåƒ
docker pull <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f echocampus-bot
```

#### æ­¥éª¤5ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8083/api/v1/health

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker-compose -f docker-compose.prod.yml ps

# æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
docker-compose -f docker-compose.prod.yml logs --tail=100
```

### æ–¹å¼äºŒï¼šæœåŠ¡å™¨ç›´æ¥æ„å»º

```bash
# è¿æ¥æœåŠ¡å™¨
ssh user@your-server-ip

# å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd echocampus-bot

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env

# æ„å»ºåç«¯
cd backend
mvn clean package -DskipTests
cd ..

# ä¿®æ”¹docker-compose.prod.ymlï¼Œä½¿ç”¨buildè€Œä¸æ˜¯image
# echocampus-bot:
#   build:
#     context: ./backend
#     dockerfile: Dockerfile

# å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d --build
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

### æœ¬åœ°å¼€å‘ç¯å¢ƒæ›´æ–°

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. é‡æ–°æ„å»ºåç«¯
cd backend
mvn clean package -DskipTests
cd ..

# 3. é‡å¯æœåŠ¡
docker-compose -f docker-compose.dev.yml down
docker-compose -f docker-compose.dev.yml up -d --build

# 4. éªŒè¯æœåŠ¡
curl http://localhost:8083/api/v1/health
```

### ç”Ÿäº§ç¯å¢ƒæ›´æ–°

```bash
# ===== æœ¬åœ°æ“ä½œ =====
cd backend
mvn clean package -DskipTests
cd ..

docker build -t echocampus:latest ./backend
docker tag echocampus:latest <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest
docker push <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest

# ===== æœåŠ¡å™¨æ“ä½œ =====
ssh <ç”¨æˆ·å>@<æœåŠ¡å™¨IP>
cd /home/<ç”¨æˆ·å>/docker-projects

# ç™»å½•é•œåƒä»“åº“
docker login --username=<é˜¿é‡Œäº‘ç”¨æˆ·å> <é•œåƒä»“åº“åœ°å€>

# æ‹‰å–æœ€æ–°é•œåƒ
docker pull <é•œåƒä»“åº“åœ°å€>/<å‘½åç©ºé—´>/echocampus:latest

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up -d

# éªŒè¯æœåŠ¡
curl http://localhost:8083/api/v1/health
docker-compose -f docker-compose.prod.yml logs --tail=50 echocampus-bot
```

---

## ğŸ¨ å‰ç«¯éƒ¨ç½²

### âš ï¸ å‰ç«¯éƒ¨ç½²æ³¨æ„äº‹é¡¹

- éƒ¨ç½²å‰éœ€æ¸…ç©ºæœåŠ¡å™¨ä¸ŠåŸæœ‰çš„å‰ç«¯å†…å®¹ã€‚
- ç¡®ä¿æ¸…ç©ºåä¸Šä¼ æ–°å†…å®¹ï¼Œä»¥è§¦å‘æœåŠ¡å™¨çš„ç¼“å­˜åˆ·æ–°æœºåˆ¶ã€‚
- æ£€æŸ¥ä¸Šä¼ å®Œæˆåï¼Œè®¿é—®å‰ç«¯é¡µé¢ä»¥éªŒè¯ç¼“å­˜åˆ·æ–°æ˜¯å¦ç”Ÿæ•ˆã€‚

### æœ¬åœ°æ„å»º

```bash
# è¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–ï¼ˆå¦‚å·²å®‰è£…å¯è·³è¿‡ï¼‰
pnpm install

# ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒAPIåœ°å€
# ç¼–è¾‘ .env.production æ–‡ä»¶
# VITE_API_BASE_URL=http://<æœåŠ¡å™¨IP>:8083/api

# æ‰“åŒ…ç”Ÿæˆdistæ–‡ä»¶å¤¹
pnpm run build
```

æ‰“åŒ…åä¼šåœ¨ `frontend` ç›®å½•ä¸‹ç”Ÿæˆ `dist` æ–‡ä»¶å¤¹ã€‚

### ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# æ¸…ç©ºæœåŠ¡å™¨ä¸Šçš„æ—§å†…å®¹ï¼ˆè§¦å‘ç¼“å­˜åˆ·æ–°ï¼‰
ssh <ç”¨æˆ·å>@<æœåŠ¡å™¨IP> "rm -rf /opt/student-projects/<ç”¨æˆ·å>/html/*"

# ä¸Šä¼ æ•´ä¸ªdistæ–‡ä»¶å¤¹å†…å®¹åˆ°æœåŠ¡å™¨
scp -r ./dist/* <ç”¨æˆ·å>@<æœåŠ¡å™¨IP>:/opt/student-projects/<ç”¨æˆ·å>/html/

# è¾“å…¥æœåŠ¡å™¨å¯†ç åå®Œæˆä¸Šä¼ 
```

**å•ä¸ªæ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹**ï¼ˆå¦‚ä»…æ›´æ–°index.htmlï¼‰ï¼š
```bash
scp index.html <ç”¨æˆ·å>@<æœåŠ¡å™¨IP>:/opt/student-projects/<ç”¨æˆ·å>/html/
```

### éªŒè¯å‰ç«¯éƒ¨ç½²

```bash
# è®¿é—®å‰ç«¯é¡µé¢
http://<æœåŠ¡å™¨IP>/

# æ£€æŸ¥APIè¿æ¥
# æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ç½‘ç»œè¯·æ±‚æ˜¯å¦æ­£å¸¸
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

**é—®é¢˜1ï¼šAPIå¯†é’¥é”™è¯¯**
```bash
# ç—‡çŠ¶ï¼šåç«¯æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œæ—¥å¿—æç¤ºAPIå¯†é’¥æ— æ•ˆ
# è§£å†³ï¼šæ£€æŸ¥.envæ–‡ä»¶ä¸­çš„APIå¯†é’¥æ˜¯å¦æ­£ç¡®
docker-compose -f docker-compose.dev.yml logs echocampus-bot | grep -i "api key"
```

**é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# ç—‡çŠ¶ï¼šåç«¯æ— æ³•è¿æ¥PostgreSQL
# è§£å†³ï¼šæ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps postgres
docker-compose -f docker-compose.dev.yml logs postgres

# æ‰‹åŠ¨æµ‹è¯•è¿æ¥
docker-compose -f docker-compose.dev.yml exec postgres psql -U postgres -d echocampus_bot
```

**é—®é¢˜3ï¼šMilvusè¿æ¥å¤±è´¥**
```bash
# ç—‡çŠ¶ï¼šå‘é‡æ•°æ®åº“è¿æ¥å¤±è´¥
# è§£å†³ï¼šæ£€æŸ¥MilvusåŠå…¶ä¾èµ–æœåŠ¡
docker-compose -f docker-compose.dev.yml ps etcd minio milvus-standalone

# æ£€æŸ¥Milvuså¥åº·çŠ¶æ€
docker-compose -f docker-compose.dev.yml exec milvus-standalone curl http://localhost:9091/healthz
```

### ç«¯å£å†²çª

```bash
# ç—‡çŠ¶ï¼šç«¯å£å·²è¢«å ç”¨
# WindowsæŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8083
netstat -ano | findstr :5432

# Linux/MacæŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8083
lsof -i :5432

# è§£å†³ï¼šä¿®æ”¹.envæ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®
BACKEND_PORT=8084
POSTGRES_PORT=5433
```

---

## ğŸ“Š æœåŠ¡è¯´æ˜

| æœåŠ¡å | å®¹å™¨å | ç«¯å£ | è¯´æ˜ |
|--------|--------|------|------|
| PostgreSQL | echocampus-postgres-dev/prod | 5432 | å…³ç³»å‹æ•°æ®åº“ |
| Milvus | echocampus-milvus-dev/prod | 19530, 9091 | å‘é‡æ•°æ®åº“ |
| etcd | echocampus-etcd-dev/prod | 2379 | Milvuså…ƒæ•°æ®å­˜å‚¨ |
| MinIO | echocampus-minio-dev/prod | 9000, 9001 | å¯¹è±¡å­˜å‚¨ |
| Attu | echocampus-attu-dev | 8000 | Milvusç®¡ç†ç•Œé¢ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰ |
| EchoCampus-Bot | echocampus-bot-dev/prod | 8080â†’8083 | åç«¯æœåŠ¡ |

---

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå¿…åš

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   ```bash
   # ç”Ÿæˆå¼ºå¯†ç 
   openssl rand -base64 32
   ```

2. **ä½¿ç”¨å¼ºJWTå¯†é’¥**
   ```bash
   # ç”Ÿæˆå¼ºJWTå¯†é’¥ï¼ˆè‡³å°‘64å­—ç¬¦ï¼‰
   openssl rand -base64 64
   ```

3. **é…ç½®CORSç™½åå•**
   ```bash
   CORS_ALLOWED_ORIGINS=https://your-frontend-domain.com
   ```

4. **é™åˆ¶ç«¯å£æš´éœ²**
   - ä¸è¦å¯¹å¤–æš´éœ²æ•°æ®åº“ç«¯å£ï¼ˆ5432ã€19530ï¼‰
   - ä½¿ç”¨Nginxåå‘ä»£ç†ä¿æŠ¤åç«¯æœåŠ¡

5. **å®šæœŸå¤‡ä»½æ•°æ®**
   ```bash
   # å¤‡ä»½PostgreSQL
   docker-compose -f docker-compose.prod.yml exec postgres pg_dump -U postgres echocampus_bot > backup.sql
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é…ç½®å®¡è®¡æŠ¥å‘Š](./é…ç½®å®¡è®¡æŠ¥å‘Š.md) - è¯¦ç»†çš„é…ç½®ä¼˜åŒ–è¯´æ˜
- [ç¯å¢ƒå˜é‡é…ç½®](./.env.example) - ç¯å¢ƒå˜é‡æ¨¡æ¿å’Œè¯´æ˜
- [æ•°æ®åº“è®¾è®¡](./docs/æ•°æ®åº“è®¾è®¡.sql) - æ•°æ®åº“è¡¨ç»“æ„

---

## ğŸ†˜ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`docker-compose -f docker-compose.{dev|prod}.yml logs -f`
2. æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š`docker-compose -f docker-compose.{dev|prod}.yml ps`
3. éªŒè¯é…ç½®æ–‡ä»¶ï¼šæ£€æŸ¥`.env`æ–‡ä»¶é…ç½®æ˜¯å¦å®Œæ•´
4. æŸ¥çœ‹å¥åº·çŠ¶æ€ï¼š`curl http://localhost:8083/api/v1/health`

---

**éƒ¨ç½²æ„‰å¿«ï¼** ğŸ‰
