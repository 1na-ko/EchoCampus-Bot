# 前端架构与重构指南

## 1. 技术栈概览

本项目采用现代 Vue 3 生态系统构建，主要技术选型如下：

| 类别 | 技术 | 说明 |
| :--- | :--- | :--- |
| **核心框架** | Vue 3 | 使用 Composition API 和 `<script setup>` 语法 |
| **编程语言** | TypeScript | 强类型支持，提高代码可维护性 |
| **构建工具** | Vite 5 | 极速的开发服务器和打包工具 |
| **状态管理** | Pinia | 轻量级、类型安全的状态管理库 |
| **路由管理** | Vue Router 4 | 路由配置与导航守卫 |
| **UI 组件库** | Ant Design Vue 4 | 企业级 UI 设计系统 |
| **HTTP 客户端** | Axios | 网络请求处理，配合拦截器封装 |
| **样式处理** | CSS Variables + Scoped CSS | 原生 CSS 变量实现主题定制 |
| **工具库** | VueUse, Dayjs, Lodash | 常用组合式 API 和工具函数 |
| **Markdown 渲染** | Marked + Highlight.js + DomPurify | 聊天消息渲染与代码高亮 |
| **测试框架** | Vitest | 单元测试与组件测试 |

## 2. 项目结构

```
frontend/
├── public/                 # 静态资源
├── src/
│   ├── api/                # API 接口统一封装
│   ├── components/         # 公共组件 (UploadProgress, etc.)
│   ├── layouts/            # 布局组件 (MainLayout)
│   ├── router/             # 路由配置
│   ├── stores/             # Pinia 状态管理 (user, chat, knowledge)
│   ├── styles/             # 全局样式与变量
│   ├── types/              # TypeScript 类型定义
│   ├── utils/              # 工具函数 (request.ts 等)
│   ├── views/              # 页面级组件 (Chat, Knowledge, Profile)
│   ├── App.vue             # 根组件
│   ├── main.ts             # 入口文件
│   └── env.d.ts            # 类型声明补丁
├── .env.development        # 开发环境配置
├── .env.production         # 生产环境配置
├── vite.config.ts          # Vite 配置
└── package.json            # 依赖管理
```

## 3. 架构设计分析

### 3.1 状态管理 (State Management)
项目使用 Pinia 进行模块化状态管理：
- **UserStore (`stores/user.ts`)**: 处理登录、注册、用户信息管理及 Token 持久化。
- **ChatStore (`stores/chat.ts`)**: 管理对话列表、当前消息记录及流式响应状态。
- **KnowledgeStore (`stores/knowledge.ts`)**: 管理知识库文档列表、上传状态及分类。

### 3.2 网络请求 (Network Layer)
- **封装 (`utils/request.ts`)**: 
  - 创建 Axios 实例，配置 BaseURL 和超时。
  - **请求拦截器**: 自动注入 `Authorization: Bearer token` 和 `X-User-Id`。
  - **响应拦截器**: 统一处理错误（如 401 跳转登录）。
- **接口定义 (`api/index.ts`)**: 
  - 将所有后端接口按模块（Auth, User, Chat, Knowledge）集中管理。
  - 强类型定义请求参数和响应结构。

### 3.3 路由与布局
- **MainLayout**: 采用侧边栏布局，响应式适配移动端。
- **路由守卫**: 全局 `beforeEach` 检查 Token，未登录用户强制重定向至 `/login`。
- **Base URL**: 配置为 `/student4/`，部署时需注意路径匹配。

### 3.4 视图实现
- **Chat.vue**: 
  - 核心交互页面，包含侧边栏（历史会话）和主聊天区域。
  - 支持 Markdown 渲染和流式输出。
  - 包含复杂的移动端适配逻辑。
- **Knowledge.vue**:
  - 文档管理中心，展示文档网格。
  - 包含搜索、筛选、上传功能。
  - UI 风格采用了“玻璃拟态 (Glassmorphism)”设计元素。

## 4. 关键配置说明

### Vite 配置 (`vite.config.ts`)
- **Base**: `/student4/` (部署子路径)
- **Proxy**: 开发环境代理 `/api` 到本地后端 `http://localhost:8083`。
- **AutoImport**: 自动导入 Vue, Vue Router, Pinia API。
- **Components**: 自动按需加载 Ant Design Vue 组件。

### 环境变量
- `VITE_API_BASE_URL`: 后端 API 地址，生产环境需正确配置。

## 5. 待重构与优化建议

在进行代码重构时，建议关注以下方面：

1.  **硬编码配置抽离**:
    - `src/utils/request.ts` 中存在硬编码的 IP 地址作为 fallback，应完全依赖环境变量。
    - `vite.config.ts` 和 `router` 中的 base url `/student4/` 应改为配置项。

2.  **组件拆分**:
    - `Chat.vue` 和 `Knowledge.vue` 单文件代码量较大（>1000行），建议将子模块（如：会话列表项、消息气泡、文档卡片、上传模态框）拆分为独立组件。

3.  **样式统一**:
    - 统一使用 CSS 变量管理颜色和间距。
    - `Knowledge.vue` 中的特殊样式（玻璃拟态）建议抽取为复用类或组件。

4.  **类型完善**:
    - 确保所有 API 返回值和组件 Props 都有明确的 TypeScript 接口定义。

5.  **国际化 (i18n)**:
    - 目前界面文本为硬编码中文，如需支持多语言，应引入 vue-i18n。

6.  **错误处理**:
    - 统一全局错误提示机制，避免在组件内部重复编写 `try-catch` 和 `message.error`。

## 6. 开发规范

- **组件命名**: 使用 PascalCase，如 `UploadProgress.vue`。
- **Store 命名**: 使用 `use{Name}Store` 格式。
- **样式**: 优先使用 scoped css，全局样式放入 `src/styles`。
- **提交**: 遵循 Git Commit Message 规范。

## 7. UI/UX 设计风格指南

本项目采用了现代、清新的设计语言，结合了 Ant Design 的企业级规范与流行的 CSS 视觉效果。

### 7.1 色彩体系 (Color Palette)

基于 `src/styles/variables.css`，核心配色方案如下：

*   **主色调 (Primary)**:
    *   紫色/靛蓝渐变: `#6366f1` (Indigo) 至 `#a855f7` (Purple)。
    *   应用场景: 按钮、链接、激活状态、关键图标。
    *   风格意图: 传达科技感、智慧与现代感。
*   **辅助色 (Secondary)**:
    *   粉色: `#ec4899`。
    *   应用场景: 强调、特殊标签、装饰性元素。
*   **中性色 (Neutrals)**:
    *   背景色: `#f8fafc` (Slate-50) 和 `#f1f5f9` (Slate-100)。不做纯白背景，降低视觉疲劳。
    *   文本颜色: `#1e293b` (Primary), `#64748b` (Secondary)。
    *   边框: `#e2e8f0`。

### 7.2 视觉效果 (Visual Effects)

*   **玻璃拟态 (Glassmorphism)**:
    *   大量使用了背景模糊 (`backdrop-filter: blur`) 和 半透明白色背景 (`rgba(255, 255, 255, 0.8)`)。
    *   主要用于: `Knowledge.vue` 的顶栏、筛选器下拉框、文档卡片，以及移动端的侧边栏背景。
*   **沉浸式背景**:
    *   页面使用 SVG 形状或渐变色块作为底层背景 (`immersive-bg` 类)，上层内容悬浮于其上。
*   **圆角与阴影**:
    *   **大圆角**: `--radius-lg: 20px`，界面元素（如卡片、按钮）普遍呈现柔和的曲率，亲和力强。
    *   **层次阴影**: 使用多层阴影 (`--shadow-md`, `--shadow-xl`) 创造悬浮感，强调 Material Design 的空间层级。

### 7.3 排版与字体 (Typography)

*   **字体家族**: 首选 `Inter`，回退至系统字体 (`-apple-system`, `PingFang SC` 等)。
*   **代码字体**: `Fira Code` 或 `Monospace`，用于聊天中的代码块显示。
*   **字号**: 基础字号 `14px`，正文阅读舒适，标题清晰分级。

### 7.4 组件风格定制

虽然使用了 Ant Design Vue，但进行了深度定制以匹配整体风格：
*   **Button**: 增加了圆角，调整了阴影，使其更符合 C 端产品的调性。
*   **Input**: 移除了默认的强边框，更多使用浅色背景或底部边框。
*   **Layout**: 侧边栏采用深色/渐变风格（视具体页面而定），与亮色内容区形成对比。

### 7.5 响应式设计

*   **断点**: 针对移动端做了专门适配（Mobile First check）。
*   **交互调整**: 移动端侧边栏自动折叠为抽屉 (Drawer) 模式，顶部增加汉堡菜单。
