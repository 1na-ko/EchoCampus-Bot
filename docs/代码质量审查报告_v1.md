# EchoCampus-Bot ç¬¬ä¸€æ¬¡ä»£ç è´¨é‡å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-01-12  
**å®¡æŸ¥äºº**: èµ„æ·±Java+Vueå…¨æ ˆå¼€å‘è€…  
**é¡¹ç›®åç§°**: EchoCampus-Bot - åŸºäºRAGæŠ€æœ¯çš„æ™ºèƒ½æ ¡å›­é—®ç­”ç³»ç»Ÿ

---

## ä¸€ã€æ‰§è¡Œæ‘˜è¦

### 1.1 å®¡æŸ¥èŒƒå›´

æœ¬æ¬¡å®¡æŸ¥å¯¹EchoCampus-Boté¡¹ç›®è¿›è¡Œäº†å…¨é¢ã€ç³»ç»Ÿæ€§çš„æŠ€æœ¯å®¡æŸ¥ï¼Œæ¶µç›–ä»¥ä¸‹æ–¹é¢ï¼š

- **åç«¯ä»£ç å®¡æŸ¥**: Spring Bootæ¡†æ¶ã€æœåŠ¡å±‚ã€æ§åˆ¶å™¨å±‚ã€é…ç½®ç±»ã€å·¥å…·ç±»ã€æ–‡æ¡£è§£æå™¨
- **å‰ç«¯ä»£ç å®¡æŸ¥**: Vue.jsæ¡†æ¶ã€çŠ¶æ€ç®¡ç†ã€APIè°ƒç”¨ã€è·¯ç”±é…ç½®ã€ç»„ä»¶è®¾è®¡
- **æŠ€æœ¯æ ˆä¸€è‡´æ€§æ ¸æŸ¥**: æ ¸å¯¹README.mdæ–‡æ¡£ä¸å®é™…ä»£ç å®ç°çš„ä¸€è‡´æ€§

### 1.2 æ•´ä½“è¯„ä»·

**æ€»ä½“è¯„åˆ†**: 7.2/10

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| æ¶æ„è®¾è®¡ | 8/10 | åˆ†å±‚æ¶æ„æ¸…æ™°ï¼ŒèŒè´£åˆ’åˆ†æ˜ç¡® |
| ä»£ç è§„èŒƒ | 7/10 | å‘½åè§„èŒƒï¼Œä½†å­˜åœ¨é­”æ³•æ•°å­—å’Œç¡¬ç¼–ç  |
| æ³¨é‡Šå®Œæ•´æ€§ | 6/10 | éƒ¨åˆ†ä»£ç ç¼ºå°‘æ³¨é‡Šï¼Œç‰¹åˆ«æ˜¯å¤æ‚é€»è¾‘ |
| é”™è¯¯å¤„ç† | 7/10 | ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œä½†éƒ¨åˆ†å¼‚å¸¸å¤„ç†ä¸å¤Ÿç»†è‡´ |
| å®‰å…¨æ€§ | 4/10 | å­˜åœ¨ä¸¥é‡å®‰å…¨éšæ‚£ï¼Œéœ€ç«‹å³ä¿®å¤ |
| æ€§èƒ½ä¼˜åŒ– | 6/10 | åŸºæœ¬ä¼˜åŒ–åˆ°ä½ï¼Œä½†ç¼ºå°‘ç¼“å­˜å’Œæµå¼å¤„ç† |
| å¯ç»´æŠ¤æ€§ | 7/10 | ä»£ç ç»“æ„æ¸…æ™°ï¼Œä½†ç¼ºå°‘æµ‹è¯• |

### 1.3 å…³é”®å‘ç°

**ä¼˜ç‚¹**:
- âœ… é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ŒæŠ€æœ¯æ ˆç°ä»£åŒ–
- âœ… ä½¿ç”¨RAGæŠ€æœ¯å®ç°æ™ºèƒ½é—®ç­”ï¼Œæ”¯æŒå¢å¼ºæ¨¡å¼
- âœ… æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼è§£æï¼ˆPDFã€TXTã€MDã€DOCXã€PPTã€PPTXã€Excelï¼‰
- âœ… å®ç°æµå¼å“åº”ï¼ˆSSEï¼‰ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- âœ… ä½¿ç”¨LangChain4jè¿›è¡Œæ™ºèƒ½æ–‡æœ¬åˆ‡å—
- âœ… å®Œæ•´çš„æ–‡æ¡£è§£æå™¨å·¥å‚æ¨¡å¼å®ç°
- âœ… å‰ç«¯ä½¿ç”¨TypeScriptï¼Œç±»å‹å®‰å…¨

**æ ¸å¿ƒä¸è¶³**:
- ğŸ”´ SecurityConfigé…ç½®é”™è¯¯ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸éœ€è¦è®¤è¯
- ğŸ”´ CORSé…ç½®å…è®¸æ‰€æœ‰æ¥æºè®¿é—®
- ğŸ”´ æ•æ„Ÿä¿¡æ¯æ˜æ–‡å­˜å‚¨ï¼ˆæ•°æ®åº“å¯†ç ã€é‚®ä»¶å¯†ç ã€APIå¯†é’¥ï¼‰
- ğŸ”´ APIå¯†é’¥å·²æ³„éœ²åˆ°ä»£ç ä»“åº“
- ğŸ”´ AIé…ç½®ç±»å†²çªï¼ˆAiConfigå’ŒAiServiceConfigï¼‰
- âš ï¸ Milvusé…ç½®ç»´åº¦ä¸ä¸€è‡´
- âš ï¸ ç¼ºå°‘è§’è‰²æƒé™æ§åˆ¶
- âš ï¸ ç¼ºå°‘CSRFå’ŒXSSé˜²æŠ¤
- âš ï¸ ç¼ºå°‘å•å…ƒæµ‹è¯•

---

## äºŒã€ä»£ç è´¨é‡è¯„ä¼°

### 2.1 æ¶æ„è®¾è®¡

#### 2.1.1 æ•´ä½“æ¶æ„

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„**å‰åç«¯åˆ†ç¦»æ¶æ„**ï¼Œç»“åˆ**RAG(Retrieval-Augmented Generation)**æŠ€æœ¯å®ç°æ™ºèƒ½é—®ç­”åŠŸèƒ½ã€‚

**æ¶æ„å±‚æ¬¡**:
```
å‰ç«¯å±‚ (Vue.js 3 + TypeScript)
    â†“ HTTP/SSE
åç«¯å±‚ (Spring Boot 3.2.1)
    â”œâ”€â”€ æ§åˆ¶å™¨å±‚ (Controller)
    â”œâ”€â”€ æœåŠ¡å±‚ (Service)
    â”œâ”€â”€ æ•°æ®è®¿é—®å±‚ (Mapper)
    â””â”€â”€ å·¥å…·å±‚ (Utils)
    â†“
æ•°æ®å­˜å‚¨å±‚
    â”œâ”€â”€ PostgreSQL 15 (å…³ç³»å‹æ•°æ®)
    â””â”€â”€ Milvus v2.3.4 (å‘é‡æ•°æ®)
    â†“
AIæœåŠ¡å±‚
    â”œâ”€â”€ é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å° Qwen3-Embedding (text-embedding-v3)
    â””â”€â”€ DeepSeek API (deepseek-chat)
```

**ä¼˜ç‚¹**:
- âœ… åˆ†å±‚æ¶æ„æ¸…æ™°ï¼ŒèŒè´£åˆ’åˆ†æ˜ç¡®
- âœ… ä½¿ç”¨ç­–ç•¥æ¨¡å¼+å·¥å‚æ¨¡å¼å®ç°æ–‡æ¡£è§£æå™¨
- âœ… æœåŠ¡å±‚æ¥å£ä¸å®ç°åˆ†ç¦»ï¼Œä¾¿äºæ‰©å±•
- âœ… ä½¿ç”¨DTOè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œé¿å…ç›´æ¥æš´éœ²å®ä½“

**ä¸è¶³**:
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ç­–ç•¥
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„æ—¥å¿—è§„èŒƒ
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„é…ç½®ç®¡ç†

#### 2.1.2 æ¨¡å—åˆ’åˆ†

**åç«¯æ¨¡å—**:
```
com.echocampus.bot
â”œâ”€â”€ annotation/          # è‡ªå®šä¹‰æ³¨è§£
â”œâ”€â”€ common/              # å…¬å…±ç»„ä»¶ï¼ˆå¼‚å¸¸ã€å“åº”ã€åˆ†é¡µï¼‰
â”œâ”€â”€ config/              # é…ç½®ç±»
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨
â”œâ”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ entity/              # å®ä½“ç±»
â”œâ”€â”€ interceptor/         # æ‹¦æˆªå™¨
â”œâ”€â”€ mapper/              # MyBatis Mapper
â”œâ”€â”€ parser/              # æ–‡æ¡£è§£æå™¨
â”œâ”€â”€ service/             # æœåŠ¡æ¥å£
â”œâ”€â”€ service/impl/        # æœåŠ¡å®ç°
â”œâ”€â”€ task/                # å®šæ—¶ä»»åŠ¡
â””â”€â”€ utils/               # å·¥å…·ç±»
```

**å‰ç«¯æ¨¡å—**:
```
src/
â”œâ”€â”€ api/                 # APIæ¥å£
â”œâ”€â”€ components/          # å…¬å…±ç»„ä»¶
â”œâ”€â”€ layouts/             # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ router/              # è·¯ç”±é…ç½®
â”œâ”€â”€ stores/              # PiniaçŠ¶æ€ç®¡ç†
â”œâ”€â”€ styles/              # å…¨å±€æ ·å¼
â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ views/               # é¡µé¢ç»„ä»¶
â”œâ”€â”€ App.vue              # æ ¹ç»„ä»¶
â””â”€â”€ main.ts              # å…¥å£æ–‡ä»¶
```

**ä¼˜ç‚¹**:
- âœ… æ¨¡å—åˆ’åˆ†æ¸…æ™°ï¼ŒèŒè´£å•ä¸€
- âœ… ä½¿ç”¨DTOéš”ç¦»å®ä½“ç±»
- âœ… å‰ç«¯ä½¿ç”¨TypeScriptï¼Œç±»å‹å®‰å…¨

**ä¸è¶³**:
- âš ï¸ éƒ¨åˆ†æœåŠ¡ç±»è¿‡å¤§ï¼ˆå¦‚ChatServiceImplè¶…è¿‡500è¡Œï¼‰
- âš ï¸ å‰ç«¯ç»„ä»¶è¿‡å¤§ï¼ˆChat.vueè¶…è¿‡1400è¡Œï¼‰
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„å¸¸é‡ç®¡ç†

### 2.2 ä»£ç è§„èŒƒ

#### 2.2.1 å‘½åè§„èŒƒ

**ä¼˜ç‚¹**:
- âœ… ç±»åä½¿ç”¨å¤§é©¼å³°å‘½åï¼ˆPascalCaseï¼‰
- âœ… æ–¹æ³•åå’Œå˜é‡åä½¿ç”¨å°é©¼å³°å‘½åï¼ˆcamelCaseï¼‰
- âœ… å¸¸é‡ä½¿ç”¨å…¨å¤§å†™ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆUPPER_SNAKE_CASEï¼‰
- âœ… åŒ…åä½¿ç”¨å…¨å°å†™

**ä¸è¶³**:
- âš ï¸ éƒ¨åˆ†å˜é‡åä¸å¤Ÿè¯­ä¹‰åŒ–ï¼ˆå¦‚`res`ã€`e`ï¼‰

#### 2.2.2 ä»£ç æ ¼å¼

**ä¼˜ç‚¹**:
- âœ… ä½¿ç”¨Lombokå‡å°‘æ ·æ¿ä»£ç 
- âœ… ä½¿ç”¨try-with-resourcesç¡®ä¿èµ„æºé‡Šæ”¾
- âœ… ä½¿ç”¨StringBuilderä¼˜åŒ–å­—ç¬¦ä¸²æ‹¼æ¥

**ä¸è¶³**:
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„ä»£ç æ ¼å¼åŒ–é…ç½®
- âš ï¸ éƒ¨åˆ†ä»£ç ç¼©è¿›ä¸ä¸€è‡´

#### 2.2.3 é­”æ³•æ•°å­—

**é—®é¢˜**: ä»£ç ä¸­å­˜åœ¨å¤§é‡ç¡¬ç¼–ç çš„é­”æ³•æ•°å­—

**ç¤ºä¾‹**:
```java
// ChatServiceImpl.java
if (historyMessages.size() > 20) {  // 20æ˜¯ä»€ä¹ˆï¼Ÿ
    historyMessages = historyMessages.subList(historyMessages.size() - 20, historyMessages.size());
}

// RagServiceImpl.java
if (similarity < 0.6) {  // 0.6æ˜¯ä»€ä¹ˆï¼Ÿ
    continue;
}

// ChatController.java
SseEmitter emitter = new SseEmitter(300000L);  // 300000æ˜¯ä»€ä¹ˆï¼Ÿ
```

**å»ºè®®**: æå–ä¸ºé…ç½®æˆ–å¸¸é‡
```java
@ConfigurationProperties(prefix = "chat")
@Data
public class ChatConfig {
    private int maxHistoryMessages = 20;
    private long sseTimeout = 300000L;
}

@ConfigurationProperties(prefix = "rag")
@Data
public class RagConfig {
    private float similarityThreshold = 0.6f;
}
```

### 2.3 æ³¨é‡Šå®Œæ•´æ€§

#### 2.3.1 ç±»æ³¨é‡Š

**ä¼˜ç‚¹**:
- âœ… å¤§éƒ¨åˆ†ç±»éƒ½æœ‰JavaDocæ³¨é‡Š
- âœ… ä½¿ç”¨Swaggeræ³¨è§£æä¾›APIæ–‡æ¡£

**ä¸è¶³**:
- âš ï¸ éƒ¨åˆ†å·¥å…·ç±»ç¼ºå°‘æ³¨é‡Š
- âš ï¸ éƒ¨åˆ†é…ç½®ç±»ç¼ºå°‘æ³¨é‡Š

#### 2.3.2 æ–¹æ³•æ³¨é‡Š

**ä¼˜ç‚¹**:
- âœ… å…¬å…±æ–¹æ³•éƒ½æœ‰JavaDocæ³¨é‡Š
- âœ… å¤æ‚é€»è¾‘æœ‰è¡Œå†…æ³¨é‡Š

**ä¸è¶³**:
- âš ï¸ éƒ¨åˆ†ç§æœ‰æ–¹æ³•ç¼ºå°‘æ³¨é‡Š
- âš ï¸ éƒ¨åˆ†å¤æ‚é€»è¾‘ç¼ºå°‘æ³¨é‡Š

#### 2.3.3 å‰ç«¯æ³¨é‡Š

**ä¼˜ç‚¹**:
- âœ… ç»„ä»¶æœ‰åŸºæœ¬æ³¨é‡Š
- âœ… å¤æ‚é€»è¾‘æœ‰æ³¨é‡Š

**ä¸è¶³**:
- âš ï¸ éƒ¨åˆ†Vueç»„ä»¶ç¼ºå°‘æ³¨é‡Š
- âš ï¸ éƒ¨åˆ†TypeScriptç±»å‹ç¼ºå°‘æ³¨é‡Š

### 2.4 é”™è¯¯å¤„ç†æœºåˆ¶

#### 2.4.1 å¼‚å¸¸å¤„ç†æ¶æ„

é¡¹ç›®é‡‡ç”¨ä¸‰å±‚å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š

**1. ä¸šåŠ¡å¼‚å¸¸å±‚**
```java
public class BusinessException extends RuntimeException {
    private final ResultCode resultCode;
    private final String message;
}
```

**2. å…¨å±€å¼‚å¸¸å¤„ç†å™¨**
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        return Result.error(e.getResultCode(), e.getMessage());
    }
}
```

**3. æ‹¦æˆªå™¨å±‚**
```java
public class JwtAuthInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // JWTéªŒè¯é€»è¾‘
    }
}
```

**ä¼˜ç‚¹**:
- âœ… ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… ä½¿ç”¨é”™è¯¯ç åˆ†ç±»å¼‚å¸¸
- âœ… ä¿ç•™åŸå§‹å¼‚å¸¸å †æ ˆ

**ä¸è¶³**:
- âš ï¸ å¼‚å¸¸å¤„ç†ä¸å¤Ÿç»†è‡´ï¼Œéƒ¨åˆ†å¼‚å¸¸è¢«åæ‰
- âš ï¸ ç¼ºå°‘å¼‚å¸¸ç›‘æ§å’Œå‘Šè­¦
- âš ï¸ ç¼ºå°‘é”™è¯¯æ—¥å¿—è®°å½•

#### 2.4.2 é”™è¯¯ç è®¾è®¡

**é”™è¯¯ç åˆ†ç±»**:
```java
public enum ResultCode {
    // æˆåŠŸ
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),
    
    // å®¢æˆ·ç«¯é”™è¯¯ 4xx
    BAD_REQUEST(400, "è¯·æ±‚å‚æ•°é”™è¯¯"),
    UNAUTHORIZED(401, "æœªç™»å½•æˆ–Tokenå·²è¿‡æœŸ"),
    FORBIDDEN(403, "æ²¡æœ‰æ“ä½œæƒé™"),
    NOT_FOUND(404, "èµ„æºä¸å­˜åœ¨"),
    VALIDATION_ERROR(422, "å‚æ•°æ ¡éªŒå¤±è´¥"),
    
    // æœåŠ¡ç«¯é”™è¯¯ 5xx
    ERROR(500, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"),
    SYSTEM_BUSY(504, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"),
    
    // ä¸šåŠ¡é”™è¯¯ 1xxx
    USER_NOT_FOUND(1001, "ç”¨æˆ·ä¸å­˜åœ¨"),
    VERIFICATION_CODE_INVALID(1006, "éªŒè¯ç æ— æ•ˆæˆ–å·²è¿‡æœŸ"),
    
    // å¯¹è¯ç›¸å…³ 2xxx
    CONVERSATION_NOT_FOUND(2001, "ä¼šè¯ä¸å­˜åœ¨"),
    
    // çŸ¥è¯†åº“ç›¸å…³ 3xxx
    DOC_NOT_FOUND(3001, "æ–‡æ¡£ä¸å­˜åœ¨"),
    UNSUPPORTED_FILE_TYPE(3005, "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹"),
    
    // AIæœåŠ¡ç›¸å…³ 4xxx
    EMBEDDING_FAILED(4001, "å‘é‡åŒ–å¤„ç†å¤±è´¥"),
    LLM_CALL_FAILED(4002, "å¤§æ¨¡å‹è°ƒç”¨å¤±è´¥");
}
```

**ä¼˜ç‚¹**:
- âœ… é”™è¯¯ç åˆ†ç±»æ¸…æ™°
- âœ… æŒ‰æ¨¡å—åˆ’åˆ†é”™è¯¯ç 
- âœ… é”™è¯¯ä¿¡æ¯å‹å¥½

**ä¸è¶³**:
- âš ï¸ ç¼ºå°‘é”™è¯¯ç æ–‡æ¡£
- âš ï¸ ç¼ºå°‘å›½é™…åŒ–æ”¯æŒ

### 2.5 å®‰å…¨æ€§å®ç°

#### 2.5.1 è®¤è¯æœºåˆ¶

**å®ç°æ–¹å¼**: JWT Tokenè®¤è¯

**ä¼˜ç‚¹**:
- âœ… ä½¿ç”¨JWTè¿›è¡Œæ— çŠ¶æ€è®¤è¯
- âœ… ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
- âœ… TokenåŒ…å«ç”¨æˆ·è§’è‰²ä¿¡æ¯

**ä¸¥é‡é—®é¢˜**:
- ğŸ”´ **SecurityConfigå®Œå…¨æ”¾è¡Œ**: æ‰€æœ‰è¯·æ±‚éƒ½ä¸éœ€è¦è®¤è¯
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(auth -> auth.anyRequest().permitAll());  // å®Œå…¨æ”¾è¡Œï¼
        return http.build();
    }
}
```

**å»ºè®®ä¿®å¤**:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/v1/auth/**").permitAll()
                .requestMatchers("/api/v1/health").permitAll()
                .requestMatchers("/api/doc.html").permitAll()
                .anyRequest().authenticated()
            );
        return http.build();
    }
}
```

#### 2.5.2 æˆæƒæœºåˆ¶

**å®ç°æ–¹å¼**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

**ä¼˜ç‚¹**:
- âœ… ä½¿ç”¨`@RequireAuth`æ³¨è§£æ ‡è®°éœ€è¦è®¤è¯çš„æ¥å£
- âœ… å‰ç«¯è·¯ç”±å®ˆå«å®ç°æƒé™æ§åˆ¶

**ä¸è¶³**:
- âš ï¸ **ç¼ºå°‘è§’è‰²æƒé™æ§åˆ¶**: åªæœ‰è®¤è¯ï¼Œæ²¡æœ‰æˆæƒ
- âš ï¸ **ç¼ºå°‘èµ„æºæ‰€æœ‰æƒéªŒè¯**: ç”¨æˆ·å¯è®¿é—®å…¶ä»–ç”¨æˆ·çš„èµ„æº

**å»ºè®®æ”¹è¿›**:
```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireRole {
    String[] value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireOwnership {
    String resourceParam();
}
```

#### 2.5.3 CORSé…ç½®

**å½“å‰é…ç½®**:
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOriginPatterns("*")  // å…è®¸æ‰€æœ‰æ¥æºï¼
            .allowedMethods("*")          // å…è®¸æ‰€æœ‰æ–¹æ³•ï¼
            .allowedHeaders("*")
            .exposedHeaders("Authorization", "Content-Disposition")
            .maxAge(3600);
    }
}
```

**ä¸¥é‡é—®é¢˜**:
- ğŸ”´ **å…è®¸æ‰€æœ‰æ¥æºè®¿é—®**: åœ¨ç”Ÿäº§ç¯å¢ƒéå¸¸å±é™©

**å»ºè®®ä¿®å¤**:
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Value("${cors.allowed-origins}")
    private String[] allowedOrigins;
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOrigins(allowedOrigins)  // ä»é…ç½®è¯»å–
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .exposedHeaders("Authorization", "Content-Disposition")
            .maxAge(3600);
    }
}
```

#### 2.5.4 æ•æ„Ÿä¿¡æ¯ç®¡ç†

**ä¸¥é‡é—®é¢˜**:
- ğŸ”´ **æ•°æ®åº“å¯†ç æ˜æ–‡å­˜å‚¨**: `password: 114514`
- ğŸ”´ **é‚®ä»¶å¯†ç æ˜æ–‡å­˜å‚¨**: `password: echo2025@YoHe`
- ğŸ”´ **APIå¯†é’¥æ˜æ–‡å­˜å‚¨**: `application-local.yml`ä¸­çš„APIå¯†é’¥
- ğŸ”´ **APIå¯†é’¥å·²æ³„éœ²**: æ–‡ä»¶å·²æäº¤åˆ°Gitä»“åº“

**å»ºè®®ä¿®å¤**:
```yaml
# application.yml
spring:
  datasource:
    password: ${DB_PASSWORD}
  mail:
    password: ${MAIL_PASSWORD}

ai:
  embedding:
    api-key: ${ALIYUN_API_KEY}
  llm:
    api-key: ${DEEPSEEK_API_KEY}

jwt:
  secret: ${JWT_SECRET}
```

**ç«‹å³è¡ŒåŠ¨**:
1. æ’¤é”€æ³„éœ²çš„APIå¯†é’¥
2. å°†`application-local.yml`æ·»åŠ åˆ°`.gitignore`
3. ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡

#### 2.5.5 å…¶ä»–å®‰å…¨é—®é¢˜

**ç¼ºå°‘çš„å®‰å…¨æªæ–½**:
- âŒ ç¼ºå°‘CSRFä¿æŠ¤
- âŒ ç¼ºå°‘XSSé˜²æŠ¤
- âŒ ç¼ºå°‘SQLæ³¨å…¥é˜²æŠ¤éªŒè¯
- âŒ ç¼ºå°‘æ•æ„Ÿæ•°æ®åŠ å¯†
- âŒ ç¼ºå°‘å®¡è®¡æ—¥å¿—
- âŒ ç¼ºå°‘HTTPSå¼ºåˆ¶

**å»ºè®®æ”¹è¿›**:
```java
// CSRFä¿æŠ¤
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()));
        return http.build();
    }
}

// XSSé˜²æŠ¤
@Configuration
public class XssConfig {
    @Bean
    public FilterRegistrationBean<XssFilter> xssFilterRegistration() {
        FilterRegistrationBean<XssFilter> registration = new FilterRegistrationBean<>();
        registration.setFilter(new XssFilter());
        registration.addUrlPatterns("/*");
        return registration;
    }
}
```

### 2.6 æ€§èƒ½ä¼˜åŒ–

#### 2.6.1 å·²å®ç°çš„ä¼˜åŒ–

**1. æ•°æ®åº“ä¼˜åŒ–**
- âœ… ä½¿ç”¨Druidè¿æ¥æ± 
- âœ… é…ç½®åˆç†çš„è¿æ¥æ± å‚æ•°
- âœ… ä½¿ç”¨MyBatis-Plusåˆ†é¡µæ’ä»¶

**2. ç¼“å­˜ä¼˜åŒ–**
- âœ… ä½¿ç”¨Mapå­˜å‚¨æ¶ˆæ¯å’Œæµå¼çŠ¶æ€
- âœ… ä½¿ç”¨localStorageæŒä¹…åŒ–ç”¨æˆ·ä¿¡æ¯

**3. å¼‚æ­¥å¤„ç†**
- âœ… ä½¿ç”¨`@Async`å¼‚æ­¥å¤„ç†æ–‡æ¡£ä¸Šä¼ 
- âœ… ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± å¤„ç†SSEè¯·æ±‚

**4. å‰ç«¯ä¼˜åŒ–**
- âœ… ä»£ç åˆ†å‰²ï¼ˆmanualChunksï¼‰
- âœ… æ‡’åŠ è½½è·¯ç”±ç»„ä»¶
- âœ… è‡ªåŠ¨å¯¼å…¥APIå’Œç»„ä»¶

#### 2.6.2 æ€§èƒ½é—®é¢˜

**1. ç¼ºå°‘ç¼“å­˜æœºåˆ¶**
- âš ï¸ Embeddingç»“æœæœªç¼“å­˜
- âš ï¸ RAGæ£€ç´¢ç»“æœæœªç¼“å­˜
- âš ï¸ ç”¨æˆ·ä¿¡æ¯æœªç¼“å­˜

**å»ºè®®**:
```java
@Cacheable(value = "embedding", key = "#text.hashCode()")
public float[] embed(String text) {
    // ...
}

@Cacheable(value = "rag", key = "#question.hashCode()")
public List<SourceDoc> retrieve(String question) {
    // ...
}
```

**2. é‡å¤å‘é‡åŒ–**
- âš ï¸ `buildSourcesWithScores`æ–¹æ³•ä¸­é‡å¤å‘é‡åŒ–æŸ¥è¯¢

**å»ºè®®**: å¤ç”¨ç¬¬ä¸€æ¬¡å‘é‡åŒ–ç»“æœ

**3. é™æµæ•°æ®æ— æ¸…ç†**
- âš ï¸ é™æµæ•°æ®åªå¢ä¸å‡ï¼Œé•¿æœŸè¿è¡Œä¼šå ç”¨å¤§é‡å†…å­˜

**å»ºè®®**: æ·»åŠ å®šæ—¶æ¸…ç†ä»»åŠ¡
```java
@Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡
public void cleanupExpiredData() {
    // æ¸…ç†è¿‡æœŸçš„é™æµè®°å½•
}
```

**4. ç¼ºå°‘æ‰¹é‡æ“ä½œä¼˜åŒ–**
- âš ï¸ å¤§æ‰¹é‡æ’å…¥å¯èƒ½æ•ˆç‡ä½

**å»ºè®®**: ä½¿ç”¨æ‰¹é‡æ’å…¥API

#### 2.6.3 æ€§èƒ½ç›‘æ§

**ç¼ºå°‘çš„ç›‘æ§**:
- âŒ ç¼ºå°‘APIå“åº”æ—¶é—´ç›‘æ§
- âŒ ç¼ºå°‘AIè°ƒç”¨æ¬¡æ•°ç»Ÿè®¡
- âŒ ç¼ºå°‘å‘é‡æ£€ç´¢æ€§èƒ½ç›‘æ§
- âŒ ç¼ºå°‘ç³»ç»Ÿèµ„æºç›‘æ§

**å»ºè®®**:
```java
@Timed(value = "rag.answer", description = "RAGé—®ç­”è€—æ—¶")
@Counted(value = "rag.answer.count", description = "RAGé—®ç­”æ¬¡æ•°")
public RagResponse answer(String question, List<Message> historyMessages, Long userId, Long conversationId) {
    // ...
}
```

---

## ä¸‰ã€æŠ€æœ¯æ ˆä¸€è‡´æ€§æ ¸æŸ¥

### 3.1 æŠ€æœ¯é”™ç”¨

| æŠ€æœ¯ | æ–‡æ¡£å£°æ˜ | å®é™…ä½¿ç”¨ | é—®é¢˜ |
|------|----------|----------|------|
| Spring Security | å¯é€‰ | å·²ä½¿ç”¨ä½†é…ç½®é”™è¯¯ | SecurityConfigå®Œå…¨æ”¾è¡Œ |
| Milvusç»´åº¦ | 1536 | 1024 | é…ç½®ä¸ä¸€è‡´ |
| DeepSeekæ¨¡å‹ | deepseek-v3.2 | deepseek-chat | æ¨¡å‹åç§°ä¸ä¸€è‡´ |
| Embeddingç»´åº¦ | 1536 | 1024 | é…ç½®ä¸ä¸€è‡´ |

### 3.2 æŠ€æœ¯é—æ¼

| æŠ€æœ¯ | æ–‡æ¡£å£°æ˜ | å®é™…ä½¿ç”¨ | è¯´æ˜ |
|------|----------|----------|------|
| Swagger/OpenAPI | âœ… | âŒ | å®é™…ä½¿ç”¨Knife4j |
| Spring Security (å¯é€‰) | âœ… | âœ… | å·²ä½¿ç”¨ä½†é…ç½®é”™è¯¯ |

### 3.3 æŠ€æœ¯å†—ä½™

| æŠ€æœ¯ | æ–‡æ¡£å£°æ˜ | å®é™…ä½¿ç”¨ | è¯´æ˜ |
|------|----------|----------|------|
| Spring Boot Starter Mail | âŒ | âœ… | ç”¨äºå‘é€éªŒè¯ç  |
| Spring Boot Starter Security | âŒ | âœ… | ç”¨äºå¯†ç åŠ å¯† |
| LangChain4j OpenAIé›†æˆ | âŒ | âœ… | ç”¨äºå·¥å…·è°ƒç”¨ |
| Apache Commons (commons-codec) | âŒ | âœ… | ç”¨äºç¼–ç è½¬æ¢ |
| Lombok | âŒ | âœ… | ç”¨äºå‡å°‘æ ·æ¿ä»£ç  |
| Hutoolå·¥å…·åŒ… | âŒ | âœ… | ç”¨äºå·¥å…·æ–¹æ³• |
| marked-highlight | âŒ | âœ… | ç”¨äºä»£ç é«˜äº® |

### 3.4 ç‰ˆæœ¬ä¸ä¸€è‡´

| æŠ€æœ¯ | æ–‡æ¡£ç‰ˆæœ¬ | å®é™…ç‰ˆæœ¬ | è¯´æ˜ |
|------|----------|----------|------|
| Spring Boot | 3.2.1 | 3.2.1 | âœ… ä¸€è‡´ |
| MyBatis-Plus | 3.5.5 | 3.5.5 | âœ… ä¸€è‡´ |
| Druid | 1.2.20 | 1.2.20 | âœ… ä¸€è‡´ |
| Milvus | v2.3.4 | 2.3.4 | âœ… ä¸€è‡´ |
| LangChain4j | 0.28.0 | 0.28.0 | âœ… ä¸€è‡´ |
| Apache PDFBox | 3.0.1 | 3.0.1 | âœ… ä¸€è‡´ |
| Apache POI | 5.2.5 | 5.2.5 | âœ… ä¸€è‡´ |
| Flexmark | 0.64.8 | 0.64.8 | âœ… ä¸€è‡´ |
| Jsoup | 1.17.2 | 1.17.2 | âœ… ä¸€è‡´ |
| OkHttp | 4.12.0 | 4.12.0 | âœ… ä¸€è‡´ |
| Knife4j | 4.4.0 | 4.4.0 | âœ… ä¸€è‡´ |
| JJWT | 0.12.3 | 0.12.3 | âœ… ä¸€è‡´ |
| Vue.js | ^3.4.0 | 3.4.0 | âœ… ä¸€è‡´ |
| Vue Router | ^4.2.5 | 4.2.5 | âœ… ä¸€è‡´ |
| Pinia | ^2.1.7 | 2.1.7 | âœ… ä¸€è‡´ |
| Axios | ^1.6.5 | 1.6.5 | âœ… ä¸€è‡´ |
| Ant Design Vue | ^4.1.1 | 4.1.1 | âœ… ä¸€è‡´ |
| TypeScript | ^5.3.3 | 5.3.3 | âœ… ä¸€è‡´ |
| Vite | ^5.0.11 | 5.0.11 | âœ… ä¸€è‡´ |

### 3.5 é…ç½®ç±»å†²çª

**ä¸¥é‡é—®é¢˜**: å­˜åœ¨ä¸¤ä¸ªAIé…ç½®ç±»ä½¿ç”¨ç›¸åŒå‰ç¼€

```java
// AiConfig.java
@Configuration
@ConfigurationProperties(prefix = "ai")
@Data
public class AiConfig {
    // ...
}

// AiServiceConfig.java
@Configuration
@ConfigurationProperties(prefix = "ai")
@Data
public class AiServiceConfig {
    // ...
}
```

**é—®é¢˜**: ä¸¤ä¸ªé…ç½®ç±»ä½¿ç”¨ç›¸åŒçš„`@ConfigurationProperties(prefix = "ai")`å‰ç¼€ï¼Œä¼šå¯¼è‡´Beanå†²çª

**å»ºè®®**: åˆ é™¤`AiConfig`ç±»ï¼Œç»Ÿä¸€ä½¿ç”¨`AiServiceConfig`

---

## å››ã€é—®é¢˜æ¸…å•

### 4.1 P0 - ä¸¥é‡é—®é¢˜ï¼ˆéœ€ç«‹å³ä¿®å¤ï¼‰

| ID | é—®é¢˜ | ä½ç½® | ä¸¥é‡ç¨‹åº¦ | å½±å“ | çŠ¶æ€ |
|----|------|------|----------|------|------|
| P0-1 | SecurityConfigå®Œå…¨æ”¾è¡Œï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸éœ€è¦è®¤è¯ | [SecurityConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\SecurityConfig.java) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-2 | CORSé…ç½®å…è®¸æ‰€æœ‰æ¥æºè®¿é—® | [WebConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\WebConfig.java) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-3 | æ•°æ®åº“å¯†ç æ˜æ–‡å­˜å‚¨ | [application.yml](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\resources\application.yml) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-4 | é‚®ä»¶å¯†ç æ˜æ–‡å­˜å‚¨ | [application.yml](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\resources\application.yml) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-5 | APIå¯†é’¥æ˜æ–‡å­˜å‚¨ | [application-local.yml](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\resources\application-local.yml) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-6 | APIå¯†é’¥å·²æ³„éœ²åˆ°Gitä»“åº“ | [application-local.yml](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\resources\application-local.yml) | ä¸¥é‡ | å®‰å…¨æ¼æ´ | å·²è§£å†³ |
| P0-7 | AIé…ç½®ç±»å†²çªï¼ˆAiConfigå’ŒAiServiceConfigï¼‰ | [AiConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\AiConfig.java) | ä¸¥é‡ | è¿è¡Œæ—¶é”™è¯¯ | å·²è§£å†³ |

#### P0é—®é¢˜ä¿®å¤è¯¦æƒ…

**ä¿®å¤æ—¶é—´**: 2026-01-12  
**ä¿®å¤äºº**: AIä»£ç åŠ©æ‰‹

**P0-1 SecurityConfigé…ç½®é”™è¯¯**
- **ä¿®å¤å†…å®¹**: å°†`anyRequest().permitAll()`æ”¹ä¸ºæ­£ç¡®çš„è®¤è¯è§„åˆ™ï¼Œä»…å…è®¸å…¬å¼€è·¯å¾„è®¿é—®
- **å…¬å¼€è·¯å¾„**: `/v1/auth/**`, `/v1/health`, `/doc.html`, `/v3/api-docs/**`, `/swagger-ui/**`, `/webjars/**`, `/favicon.ico`
- **å…¶ä»–è·¯å¾„**: éœ€è¦JWTè®¤è¯
- **å½±å“**: å‰ç«¯éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦æœ‰æ•ˆçš„JWT Token

**P0-2 CORSé…ç½®è¿‡äºå®½æ¾**
- **ä¿®å¤å†…å®¹**: å°†`allowedOriginPatterns("*")`æ”¹ä¸ºä»é…ç½®æ–‡ä»¶è¯»å–å…è®¸çš„æ¥æº
- **æ–°å¢é…ç½®**: åœ¨`application.yml`ä¸­æ·»åŠ `cors.allowed-origins`é…ç½®é¡¹
- **é™åˆ¶æ–¹æ³•**: GET, POST, PUT, DELETE, OPTIONS
- **é»˜è®¤å€¼**: `http://localhost:3100`, `http://localhost:5173`

**P0-3 æ•°æ®åº“å¯†ç æ˜æ–‡å­˜å‚¨**
- **ä¿®å¤å†…å®¹**: å°†æ•°æ®åº“å¯†ç æ”¹ä¸ºç¯å¢ƒå˜é‡å¼•ç”¨`${DB_PASSWORD}`
- **å½±å“**: éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡`DB_PASSWORD`

**P0-4 é‚®ä»¶å¯†ç æ˜æ–‡å­˜å‚¨**
- **ä¿®å¤å†…å®¹**: å°†é‚®ä»¶å¯†ç æ”¹ä¸ºç¯å¢ƒå˜é‡å¼•ç”¨`${MAIL_PASSWORD}`
- **å½±å“**: éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡`MAIL_PASSWORD`

**P0-5 APIå¯†é’¥æ˜æ–‡å­˜å‚¨**
- **ä¿®å¤å†…å®¹**: APIå¯†é’¥å·²ä½¿ç”¨ç¯å¢ƒå˜é‡å¼•ç”¨ï¼ˆåŸæœ‰é…ç½®å·²æ­£ç¡®ï¼‰
- **å½±å“**: éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡`ALIYUN_API_KEY`å’Œ`DEEPSEEK_API_KEY`

**P0-6 APIå¯†é’¥å·²æ³„éœ²åˆ°Gitä»“åº“**
- **ä¿®å¤å†…å®¹**: ç¡®è®¤`application-local.yml`å·²åœ¨`.gitignore`ä¸­ï¼Œæ–‡ä»¶æœªè¢«æäº¤åˆ°Gitå†å²
- **çŠ¶æ€**: ç»æ£€æŸ¥ï¼ŒAPIå¯†é’¥æœªæ³„éœ²åˆ°GitHubä»“åº“ï¼Œé…ç½®æ–‡ä»¶å·²æ­£ç¡®è®¾ç½®gitignore
- **è¯´æ˜**: è¯¥é—®é¢˜å®é™…ä¸å­˜åœ¨ï¼Œä»…ä½œä¸ºé¢„é˜²æ€§æ£€æŸ¥

**P0-7 AIé…ç½®ç±»å†²çª**
- **ä¿®å¤å†…å®¹**: åˆ é™¤`AiConfig.java`æ–‡ä»¶ï¼Œç»Ÿä¸€ä½¿ç”¨`AiServiceConfig`
- **æ›´æ–°æ–‡ä»¶**: 
  - `EmbeddingServiceImpl.java`
  - `LlmServiceImpl.java`
  - `EnhancedLlmServiceImpl.java`
- **å½±å“**: æ‰€æœ‰å¼•ç”¨`AiConfig`çš„åœ°æ–¹å·²æ›´æ–°ä¸º`AiServiceConfig`

### 4.2 P1 - é«˜ä¼˜å…ˆçº§é—®é¢˜

| ID | é—®é¢˜ | ä½ç½® | ä¸¥é‡ç¨‹åº¦ | å½±å“ | çŠ¶æ€ |
|----|------|------|----------|------|------|
| P1-1 | Milvusé…ç½®ç»´åº¦ä¸ä¸€è‡´ï¼ˆæ–‡æ¡£1536 vs å®é™…1024ï¼‰ | [MilvusConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\MilvusConfig.java) | é«˜ | é…ç½®é”™è¯¯ | å·²è§£å†³ |
| P1-2 | æ–‡æ¡£è§£æå™¨ç¼ºå°‘å‚æ•°éªŒè¯ | [DocumentParser.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\parser\DocumentParser.java) | é«˜ | å¯èƒ½å¯¼è‡´å¼‚å¸¸ | å¾…ä¿®å¤ |
| P1-3 | é™æµæ•°æ®æ— æ¸…ç†æœºåˆ¶ | [RateLimitConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\RateLimitConfig.java) | é«˜ | å†…å­˜æ³„æ¼é£é™© | å¾…ä¿®å¤ |
| P1-4 | ç¼ºå°‘è§’è‰²æƒé™æ§åˆ¶ | [JwtAuthInterceptor.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\interceptor\JwtAuthInterceptor.java) | é«˜ | æƒé™æ¼æ´ | å¾…ä¿®å¤ |
| P1-5 | ç¼ºå°‘CSRFå’ŒXSSé˜²æŠ¤ | - | é«˜ | å®‰å…¨æ¼æ´ | å¾…ä¿®å¤ |
| P1-6 | æ–‡æ¡£è§£æå™¨é‡å¤è°ƒç”¨parse() | [DocxDocumentParser.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\parser\impl\DocxDocumentParser.java) | é«˜ | æ€§èƒ½é—®é¢˜ | å¾…ä¿®å¤ |
| P1-7 | ç¼ºå°‘æ–‡ä»¶å¤§å°é™åˆ¶ | [KnowledgeServiceImpl.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\service\impl\KnowledgeServiceImpl.java) | é«˜ | å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º | å¾…ä¿®å¤ |

#### P1-1é—®é¢˜ä¿®å¤è¯¦æƒ…

**ä¿®å¤æ—¶é—´**: 2026-01-12  
**ä¿®å¤äºº**: AIä»£ç åŠ©æ‰‹

**P1-1 Milvusé…ç½®ç»´åº¦ä¸ä¸€è‡´**
- **ä¿®å¤å†…å®¹**: å°†`MilvusConfig.java`å’Œ`AiServiceConfig.java`ä¸­çš„é»˜è®¤ç»´åº¦ä»1536æ”¹ä¸º1024
- **å½±å“**: ç¡®ä¿ä¸`application.yml`ä¸­çš„é…ç½®ä¸€è‡´ï¼Œé¿å…å‘é‡ç»´åº¦ä¸åŒ¹é…é—®é¢˜

### 4.3 P2 - ä¸­ä¼˜å…ˆçº§é—®é¢˜

| ID | é—®é¢˜ | ä½ç½® | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|----|------|------|----------|------|
| P2-1 | æœåŠ¡å±‚å­˜åœ¨é‡å¤ä»£ç  | [ChatServiceImpl.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\service\impl\ChatServiceImpl.java) | ä¸­ | å¯ç»´æŠ¤æ€§ |
| P2-2 | ç¼ºå°‘ç¼“å­˜æœºåˆ¶ | - | ä¸­ | æ€§èƒ½é—®é¢˜ |
| P2-3 | ç¼ºå°‘å•å…ƒæµ‹è¯• | - | ä¸­ | ä»£ç è´¨é‡ |
| P2-4 | æ§åˆ¶å™¨ç¼ºå°‘è¾“å…¥éªŒè¯ | [ChatController.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\controller\ChatController.java) | ä¸­ | å¯èƒ½å¯¼è‡´å¼‚å¸¸ |
| P2-5 | SSEç¼ºå°‘å¿ƒè·³æœºåˆ¶ | [ChatController.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\controller\ChatController.java) | ä¸­ | ç”¨æˆ·ä½“éªŒ |
| P2-6 | å¼‚å¸¸å¤„ç†ä¸å¤Ÿç»†è‡´ | [GlobalExceptionHandler.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\common\GlobalExceptionHandler.java) | ä¸­ | é”™è¯¯å¤„ç† |
| P2-7 | ç¼ºå°‘è¯·æ±‚æ—¥å¿— | - | ä¸­ | å¯è°ƒè¯•æ€§ |
| P2-8 | ç¼ºå°‘æ€§èƒ½ç›‘æ§ | - | ä¸­ | å¯è§‚æµ‹æ€§ |

### 4.4 P3 - ä½ä¼˜å…ˆçº§é—®é¢˜

| ID | é—®é¢˜ | ä½ç½® | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|----|------|------|----------|------|
| P3-1 | é­”æ³•æ•°å­—åº”å®šä¹‰ä¸ºå¸¸é‡ | å¤šå¤„ | ä½ | å¯ç»´æŠ¤æ€§ |
| P3-2 | ç»„ä»¶å¯ä»¥è¿›ä¸€æ­¥æ‹†åˆ† | [Chat.vue](file:///f:\CodeforJAVA\EchoCampus-Bot\frontend\src\views\Chat.vue) | ä½ | å¯ç»´æŠ¤æ€§ |
| P3-3 | ç¼ºå°‘ä»£ç æ ¼å¼åŒ–é…ç½® | - | ä½ | ä»£ç è§„èŒƒ |
| P3-4 | ç¼ºå°‘å›½é™…åŒ–æ”¯æŒ | - | ä½ | ç”¨æˆ·ä½“éªŒ |
| P3-5 | ç¼ºå°‘APIç‰ˆæœ¬ç®¡ç† | - | ä½ | å¯æ‰©å±•æ€§ |
| P3-6 | ç¼ºå°‘å®¡è®¡æ—¥å¿— | - | ä½ | å®‰å…¨æ€§ |

---

## äº”ã€æ”¹è¿›å»ºè®®

### 5.1 P0 - ç«‹å³ä¿®å¤

#### ä¿®å¤1: SecurityConfigé…ç½®é”™è¯¯

**å½“å‰ä»£ç **:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(auth -> auth.anyRequest().permitAll());
        return http.build();
    }
}
```

**ä¿®å¤å**:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/v1/auth/**").permitAll()
                .requestMatchers("/api/v1/health").permitAll()
                .requestMatchers("/api/doc.html").permitAll()
                .requestMatchers("/v3/api-docs/**").permitAll()
                .anyRequest().authenticated()
            );
        return http.build();
    }
}
```

#### ä¿®å¤2: CORSé…ç½®è¿‡äºå®½æ¾

**å½“å‰ä»£ç **:
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOriginPatterns("*")
            .allowedMethods("*")
            .allowedHeaders("*")
            .exposedHeaders("Authorization", "Content-Disposition")
            .maxAge(3600);
    }
}
```

**ä¿®å¤å**:
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Value("${cors.allowed-origins:http://localhost:3100}")
    private String[] allowedOrigins;
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOrigins(allowedOrigins)
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .exposedHeaders("Authorization", "Content-Disposition")
            .maxAge(3600);
    }
}
```

**é…ç½®æ–‡ä»¶**:
```yaml
# application.yml
cors:
  allowed-origins:
    - http://localhost:3100
    - https://yourdomain.com
```

#### ä¿®å¤3: æ•æ„Ÿä¿¡æ¯ç®¡ç†

**å½“å‰ä»£ç **:
```yaml
# application.yml
spring:
  datasource:
    password: 114514
  mail:
    password: echo2025@YoHe

ai:
  embedding:
    api-key: ${ALIYUN_API_KEY:your_aliyun_api_key}
  llm:
    api-key: ${DEEPSEEK_API_KEY:your_deepseek_api_key}
```

**ä¿®å¤å**:
```yaml
# application.yml
spring:
  datasource:
    password: ${DB_PASSWORD}
  mail:
    password: ${MAIL_PASSWORD}

ai:
  embedding:
    api-key: ${ALIYUN_API_KEY}
  llm:
    api-key: ${DEEPSEEK_API_KEY}

jwt:
  secret: ${JWT_SECRET}
```

**ç¯å¢ƒå˜é‡**:
```bash
# .env
DB_PASSWORD=your_secure_password
MAIL_PASSWORD=your_mail_password
ALIYUN_API_KEY=your_aliyun_api_key
DEEPSEEK_API_KEY=your_deepseek_api_key
JWT_SECRET=your_jwt_secret_key
```

#### ä¿®å¤4: APIå¯†é’¥å®‰å…¨æ£€æŸ¥

**æ£€æŸ¥ç»“æœ**:
- `application-local.yml`å·²åœ¨`.gitignore`ä¸­
- æ–‡ä»¶æœªè¢«æäº¤åˆ°Gitå†å²
- APIå¯†é’¥æœªæ³„éœ²åˆ°GitHubä»“åº“
- é…ç½®æ–‡ä»¶å·²æ­£ç¡®è®¾ç½®gitignore

**è¯´æ˜**: è¯¥é—®é¢˜å®é™…ä¸å­˜åœ¨ï¼Œä»…ä½œä¸ºé¢„é˜²æ€§æ£€æŸ¥

#### ä¿®å¤5: åˆ é™¤é‡å¤çš„AiConfigç±»

**åˆ é™¤æ–‡ä»¶**: [AiConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\AiConfig.java)

**åŸå› **: ä¸`AiServiceConfig`ä½¿ç”¨ç›¸åŒçš„`@ConfigurationProperties(prefix = "ai")`å‰ç¼€ï¼Œä¼šå¯¼è‡´Beanå†²çª

### 5.2 P1 - é«˜ä¼˜å…ˆçº§æ”¹è¿›

#### æ”¹è¿›1: ç»Ÿä¸€Milvusé…ç½®ç»´åº¦

**å½“å‰é…ç½®**:
```yaml
# application.yml
milvus:
  dimension: 1024
```

```java
// MilvusConfig.java
@ConfigurationProperties(prefix = "milvus")
@Data
public class MilvusConfig {
    private int dimension = 1536;  // é»˜è®¤å€¼ä¸é…ç½®æ–‡ä»¶ä¸ä¸€è‡´
}
```

**ä¿®å¤å**:
```yaml
# application.yml
milvus:
  dimension: 1024
```

```java
// MilvusConfig.java
@ConfigurationProperties(prefix = "milvus")
@Data
public class MilvusConfig {
    private int dimension = 1024;  // ç»Ÿä¸€ä¸º1024
}
```

#### æ”¹è¿›2: æ·»åŠ æ–‡æ¡£è§£æå™¨å‚æ•°éªŒè¯

**å½“å‰ä»£ç **:
```java
public String parse(String filePath) throws DocumentParseException {
    try (PDDocument document = Loader.loadPDF(new File(filePath))) {
        // ...
    }
}
```

**ä¿®å¤å**:
```java
public String parse(String filePath) throws DocumentParseException {
    if (filePath == null || filePath.trim().isEmpty()) {
        throw new DocumentParseException("æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º");
    }
    
    File file = new File(filePath);
    if (!file.exists()) {
        throw new DocumentParseException("æ–‡ä»¶ä¸å­˜åœ¨: " + filePath);
    }
    
    if (!file.canRead()) {
        throw new DocumentParseException("æ–‡ä»¶ä¸å¯è¯»: " + filePath);
    }
    
    if (file.length() > MAX_FILE_SIZE) {
        throw new DocumentParseException("æ–‡ä»¶è¿‡å¤§: " + file.length() + " bytes");
    }
    
    try (PDDocument document = Loader.loadPDF(file)) {
        // ...
    }
}
```

#### æ”¹è¿›3: æ·»åŠ é™æµæ•°æ®æ¸…ç†æœºåˆ¶

**å½“å‰ä»£ç **:
```java
@Component
public class RateLimitConfig {
    private final Map<Long, Long> userRequestCount = new ConcurrentHashMap<>();
    private final Map<Long, Long> sseConnectionCount = new ConcurrentHashMap<>();
    // ...
}
```

**ä¿®å¤å**:
```java
@Component
public class RateLimitConfig {
    private final Map<Long, Long> userRequestCount = new ConcurrentHashMap<>();
    private final Map<Long, Long> sseConnectionCount = new ConcurrentHashMap<>();
    
    @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡
    public void cleanupExpiredData() {
        long now = System.currentTimeMillis();
        long expireTime = now - TimeUnit.HOURS.toMillis(1);
        
        userRequestCount.entrySet().removeIf(entry -> entry.getValue() < expireTime);
        sseConnectionCount.entrySet().removeIf(entry -> entry.getValue() < expireTime);
        
        log.info("é™æµæ•°æ®æ¸…ç†å®Œæˆ");
    }
}
```

#### æ”¹è¿›4: æ·»åŠ è§’è‰²æƒé™æ§åˆ¶

**åˆ›å»ºæ³¨è§£**:
```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireRole {
    String[] value();
}
```

**åˆ›å»ºæ‹¦æˆªå™¨**:
```java
@Component
public class RoleInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        if (!(handler instanceof HandlerMethod)) {
            return true;
        }
        
        HandlerMethod handlerMethod = (HandlerMethod) handler;
        RequireRole requireRole = handlerMethod.getMethodAnnotation(RequireRole.class);
        
        if (requireRole == null) {
            return true;
        }
        
        String userRole = (String) request.getAttribute("userRole");
        if (userRole == null) {
            throw new BusinessException(ResultCode.UNAUTHORIZED);
        }
        
        boolean hasRole = Arrays.asList(requireRole.value()).contains(userRole);
        if (!hasRole) {
            throw new BusinessException(ResultCode.FORBIDDEN);
        }
        
        return true;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```java
@PostMapping("/docs")
@RequireRole({"ADMIN"})
public Result<KnowledgeDoc> uploadDocument(@RequestParam("file") MultipartFile file) {
    // ...
}
```

#### æ”¹è¿›5: æ·»åŠ CSRFå’ŒXSSé˜²æŠ¤

**CSRFé˜²æŠ¤**:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()));
        return http.build();
    }
}
```

**XSSé˜²æŠ¤**:
```java
@Component
public class XssFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) 
            throws IOException, ServletException {
        XssHttpServletRequestWrapper wrappedRequest = new XssHttpServletRequestWrapper((HttpServletRequest) request);
        chain.doFilter(wrappedRequest, response);
    }
}

public class XssHttpServletRequestWrapper extends HttpServletRequestWrapper {
    @Override
    public String getParameter(String name) {
        String value = super.getParameter(name);
        return cleanXss(value);
    }
    
    @Override
    public String[] getParameterValues(String name) {
        String[] values = super.getParameterValues(name);
        if (values == null) {
            return null;
        }
        String[] cleanValues = new String[values.length];
        for (int i = 0; i < values.length; i++) {
            cleanValues[i] = cleanXss(values[i]);
        }
        return cleanValues;
    }
    
    private String cleanXss(String value) {
        if (value == null) {
            return null;
        }
        value = value.replaceAll("<", "&lt;").replaceAll(">", "&gt;");
        value = value.replaceAll("\\(", "&#40;").replaceAll("\\)", "&#41;");
        value = value.replaceAll("'", "&#39;");
        value = value.replaceAll("eval\\((.*)\\)", "");
        value = value.replaceAll("[\\\"\\\'][\\s]*javascript:(.*)[\\\"\\\']", "\"\"");
        value = value.replaceAll("script", "");
        return value;
    }
}
```

### 5.3 P2 - ä¸­ä¼˜å…ˆçº§æ”¹è¿›

#### æ”¹è¿›1: æ·»åŠ ç¼“å­˜æœºåˆ¶

**Embeddingç¼“å­˜**:
```java
@Service
public class EmbeddingServiceImpl implements EmbeddingService {
    private final Cache<String, float[]> embeddingCache = 
        Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(1, TimeUnit.HOURS)
            .build();
    
    @Override
    public float[] embed(String text) {
        return embeddingCache.get(text, key -> {
            // å®é™…çš„å‘é‡åŒ–é€»è¾‘
            return doEmbed(text);
        });
    }
}
```

**RAGæ£€ç´¢ç¼“å­˜**:
```java
@Service
public class RagServiceImpl implements RagService {
    private final Cache<String, List<SourceDoc>> retrievalCache = 
        Caffeine.newBuilder()
            .maximumSize(500)
            .expireAfterWrite(30, TimeUnit.MINUTES)
            .build();
    
    @Override
    public List<SourceDoc> retrieve(String question, int topK) {
        String cacheKey = question + ":" + topK;
        return retrievalCache.get(cacheKey, key -> {
            // å®é™…çš„æ£€ç´¢é€»è¾‘
            return doRetrieve(question, topK);
        });
    }
}
```

#### æ”¹è¿›2: æ·»åŠ å•å…ƒæµ‹è¯•

**ç¤ºä¾‹æµ‹è¯•**:
```java
@SpringBootTest
class ChatServiceTest {
    @Autowired
    private ChatService chatService;
    
    @Test
    void testSendMessage() {
        ChatRequest request = new ChatRequest();
        request.setMessage("ä»€ä¹ˆæ˜¯Spring Boot?");
        
        ChatResponse response = chatService.sendMessage(request);
        
        assertNotNull(response);
        assertNotNull(response.getAnswer());
        assertTrue(response.getAnswer().contains("Spring"));
    }
    
    @Test
    void testSendMessageWithEmptyMessage() {
        ChatRequest request = new ChatRequest();
        request.setMessage("");
        
        assertThrows(BusinessException.class, () -> {
            chatService.sendMessage(request);
        });
    }
}
```

#### æ”¹è¿›3: æ·»åŠ SSEå¿ƒè·³æœºåˆ¶

**å½“å‰ä»£ç **:
```java
@PostMapping(value = "/message/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public SseEmitter sendMessageStream(HttpServletRequest request, @Valid @RequestBody ChatRequest chatRequest) {
    SseEmitter emitter = new SseEmitter(300000L);
    
    sseExecutor.execute(() -> {
        chatService.sendMessageStream(userId, chatRequest, streamResponse -> {
            String json = objectMapper.writeValueAsString(streamResponse);
            emitter.send(SseEmitter.event()
                .name(streamResponse.getType().name().toLowerCase())
                .data(json));
        });
        emitter.complete();
    });
    
    return emitter;
}
```

**ä¿®å¤å**:
```java
@PostMapping(value = "/message/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public SseEmitter sendMessageStream(HttpServletRequest request, @Valid @RequestBody ChatRequest chatRequest) {
    SseEmitter emitter = new SseEmitter(300000L);
    
    ScheduledExecutorService heartbeatExecutor = Executors.newSingleThreadScheduledExecutor();
    heartbeatExecutor.scheduleAtFixedRate(() -> {
        try {
            emitter.send(SseEmitter.event().name("heartbeat").data("ping"));
        } catch (IOException e) {
            emitter.complete();
            heartbeatExecutor.shutdown();
        }
    }, 30, 30, TimeUnit.SECONDS);
    
    emitter.onCompletion(() -> heartbeatExecutor.shutdown());
    emitter.onTimeout(() -> {
        heartbeatExecutor.shutdown();
        emitter.complete();
    });
    
    sseExecutor.execute(() -> {
        chatService.sendMessageStream(userId, chatRequest, streamResponse -> {
            String json = objectMapper.writeValueAsString(streamResponse);
            emitter.send(SseEmitter.event()
                .name(streamResponse.getType().name().toLowerCase())
                .data(json));
        });
        emitter.complete();
    });
    
    return emitter;
}
```

#### æ”¹è¿›4: æ·»åŠ è¯·æ±‚æ—¥å¿—

**åˆ›å»ºAOPåˆ‡é¢**:
```java
@Aspect
@Component
@Slf4j
public class ApiLogAspect {
    @Around("@annotation(org.springframework.web.bind.annotation.*Mapping)")
    public Object logApi(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        
        String method = request.getMethod();
        String uri = request.getRequestURI();
        String ip = request.getRemoteAddr();
        
        log.info("APIè¯·æ±‚: method={}, uri={}, ip={}", method, uri, ip);
        
        try {
            Object result = joinPoint.proceed();
            long duration = System.currentTimeMillis() - startTime;
            log.info("APIå“åº”: method={}, uri={}, duration={}ms", method, uri, duration);
            return result;
        } catch (Exception e) {
            long duration = System.currentTimeMillis() - startTime;
            log.error("APIå¼‚å¸¸: method={}, uri={}, duration={}ms, error={}", method, uri, duration, e.getMessage());
            throw e;
        }
    }
}
```

### 5.4 P3 - ä½ä¼˜å…ˆçº§æ”¹è¿›

#### æ”¹è¿›1: æå–é­”æ³•æ•°å­—ä¸ºå¸¸é‡

**åˆ›å»ºé…ç½®ç±»**:
```java
@Configuration
@ConfigurationProperties(prefix = "chat")
@Data
public class ChatConfig {
    private int maxHistoryMessages = 20;
    private long sseTimeout = 300000L;
}

@Configuration
@ConfigurationProperties(prefix = "rag")
@Data
public class RagConfig {
    private int topK = 5;
    private float similarityThreshold = 0.6f;
    private int maxContextLength = 4000;
}
```

**ä½¿ç”¨é…ç½®**:
```java
@Service
public class ChatServiceImpl implements ChatService {
    private final ChatConfig chatConfig;
    private final RagConfig ragConfig;
    
    @Override
    public ChatResponse sendMessage(ChatRequest request) {
        if (historyMessages.size() > chatConfig.getMaxHistoryMessages()) {
            historyMessages = historyMessages.subList(
                historyMessages.size() - chatConfig.getMaxHistoryMessages(), 
                historyMessages.size()
            );
        }
        
        if (similarity < ragConfig.getSimilarityThreshold()) {
            continue;
        }
    }
}
```

#### æ”¹è¿›2: æ‹†åˆ†å¤§å‹ç»„ä»¶

**Chat.vueæ‹†åˆ†**:
```
views/
â”œâ”€â”€ Chat.vue                    # ä¸»ç»„ä»¶
â””â”€â”€ chat/
    â”œâ”€â”€ ChatMessageList.vue     # æ¶ˆæ¯åˆ—è¡¨
    â”œâ”€â”€ ChatInput.vue           # è¾“å…¥æ¡†
    â”œâ”€â”€ ChatSidebar.vue         # ä¾§è¾¹æ 
    â””â”€â”€ ChatSourceCard.vue      # æ¥æºå¡ç‰‡
```

#### æ”¹è¿›3: æ·»åŠ æ€§èƒ½ç›‘æ§

**é›†æˆMicrometer**:
```xml
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**æ·»åŠ ç›‘æ§æ³¨è§£**:
```java
@Service
public class ChatServiceImpl implements ChatService {
    @Timed(value = "chat.send_message", description = "å‘é€æ¶ˆæ¯è€—æ—¶")
    @Counted(value = "chat.send_message.count", description = "å‘é€æ¶ˆæ¯æ¬¡æ•°")
    public ChatResponse sendMessage(ChatRequest request) {
        // ...
    }
}
```

---

## å…­ã€å®æ–½ä¼˜å…ˆçº§

### 6.1 ç«‹å³æ‰§è¡Œï¼ˆ1-3å¤©ï¼‰

1. **æ’¤é”€æ³„éœ²çš„APIå¯†é’¥** - P0-6
2. **ä¿®å¤SecurityConfigé…ç½®é”™è¯¯** - P0-1
3. **ä¿®å¤CORSé…ç½®** - P0-2
4. **åˆ é™¤é‡å¤çš„AiConfigç±»** - P0-7
5. **å°†æ•æ„Ÿé…ç½®ç§»åˆ°ç¯å¢ƒå˜é‡** - P0-3, P0-4, P0-5

### 6.2 çŸ­æœŸæ‰§è¡Œï¼ˆ1-2å‘¨ï¼‰

1. **ç»Ÿä¸€Milvusé…ç½®ç»´åº¦** - P1-1
2. **æ·»åŠ æ–‡æ¡£è§£æå™¨å‚æ•°éªŒè¯** - P1-2
3. **æ·»åŠ é™æµæ•°æ®æ¸…ç†æœºåˆ¶** - P1-3
4. **æ·»åŠ è§’è‰²æƒé™æ§åˆ¶** - P1-4
5. **æ·»åŠ CSRFå’ŒXSSé˜²æŠ¤** - P1-5
6. **æ·»åŠ æ–‡ä»¶å¤§å°é™åˆ¶** - P1-7
7. **æ¶ˆé™¤æ–‡æ¡£è§£æå™¨é‡å¤è°ƒç”¨** - P1-6

### 6.3 ä¸­æœŸæ‰§è¡Œï¼ˆ1ä¸ªæœˆï¼‰

1. **æ·»åŠ ç¼“å­˜æœºåˆ¶** - P2-2
2. **æ·»åŠ å•å…ƒæµ‹è¯•** - P2-3
3. **æ·»åŠ SSEå¿ƒè·³æœºåˆ¶** - P2-5
4. **æ·»åŠ è¯·æ±‚æ—¥å¿—** - P2-7
5. **æ·»åŠ æ€§èƒ½ç›‘æ§** - P2-8

### 6.4 é•¿æœŸæ‰§è¡Œï¼ˆæŒç»­ä¼˜åŒ–ï¼‰

1. **æå–é­”æ³•æ•°å­—ä¸ºå¸¸é‡** - P3-1
2. **æ‹†åˆ†å¤§å‹ç»„ä»¶** - P3-2
3. **æ·»åŠ ä»£ç æ ¼å¼åŒ–é…ç½®** - P3-3
4. **æ·»åŠ å›½é™…åŒ–æ”¯æŒ** - P3-4
5. **æ·»åŠ APIç‰ˆæœ¬ç®¡ç†** - P3-5
6. **æ·»åŠ å®¡è®¡æ—¥å¿—** - P3-6

---

## ä¸ƒã€æ€»ç»“

### 7.1 é¡¹ç›®ä¼˜åŠ¿

1. **æ¶æ„è®¾è®¡åˆç†**: é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œåˆ†å±‚æ¸…æ™°
2. **æŠ€æœ¯æ ˆç°ä»£åŒ–**: ä½¿ç”¨Spring Boot 3ã€Vue 3ã€TypeScriptç­‰ç°ä»£æŠ€æœ¯
3. **åŠŸèƒ½å®Œå–„**: æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ã€æµå¼å“åº”ã€å¢å¼ºRAGæ¨¡å¼
4. **ä»£ç è´¨é‡è¾ƒé«˜**: å‘½åè§„èŒƒã€ç»“æ„æ¸…æ™°ã€æ³¨é‡Šè¾ƒå®Œæ•´
5. **ç”¨æˆ·ä½“éªŒè‰¯å¥½**: æµå¼å“åº”ã€å®æ—¶è¿›åº¦ã€å“åº”å¼è®¾è®¡

### 7.2 æ ¸å¿ƒé—®é¢˜

1. **å®‰å…¨æ€§é—®é¢˜ä¸¥é‡**: SecurityConfigé…ç½®é”™è¯¯ã€CORSè¿‡äºå®½æ¾ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²
2. **é…ç½®ç®¡ç†æ··ä¹±**: AIé…ç½®ç±»å†²çªã€Milvusç»´åº¦ä¸ä¸€è‡´
3. **ç¼ºå°‘å®‰å…¨é˜²æŠ¤**: ç¼ºå°‘CSRFã€XSSé˜²æŠ¤ï¼Œç¼ºå°‘è§’è‰²æƒé™æ§åˆ¶
4. **æ€§èƒ½ä¼˜åŒ–ä¸è¶³**: ç¼ºå°‘ç¼“å­˜æœºåˆ¶ã€é™æµæ•°æ®æ— æ¸…ç†
5. **æµ‹è¯•è¦†ç›–ä¸è¶³**: ç¼ºå°‘å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### 7.3 æ”¹è¿›å»ºè®®

**ç«‹å³è¡ŒåŠ¨**:
1. æ’¤é”€æ³„éœ²çš„APIå¯†é’¥
2. ä¿®å¤SecurityConfigå’ŒCORSé…ç½®
3. åˆ é™¤é‡å¤çš„AiConfigç±»
4. å°†æ•æ„Ÿé…ç½®ç§»åˆ°ç¯å¢ƒå˜é‡

**çŸ­æœŸæ”¹è¿›**:
1. ç»Ÿä¸€é…ç½®ç»´åº¦
2. æ·»åŠ å‚æ•°éªŒè¯
3. æ·»åŠ é™æµæ¸…ç†æœºåˆ¶
4. æ·»åŠ è§’è‰²æƒé™æ§åˆ¶
5. æ·»åŠ CSRFå’ŒXSSé˜²æŠ¤

**é•¿æœŸä¼˜åŒ–**:
1. æ·»åŠ ç¼“å­˜æœºåˆ¶
2. æ·»åŠ å•å…ƒæµ‹è¯•
3. æ·»åŠ æ€§èƒ½ç›‘æ§
4. ä¼˜åŒ–ä»£ç ç»“æ„
5. å®Œå–„æ–‡æ¡£

### 7.4 æœ€ç»ˆè¯„ä»·

EchoCampus-Boté¡¹ç›®æ˜¯ä¸€ä¸ª**åŠŸèƒ½å®Œå–„ã€æ¶æ„åˆç†**çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œä½†åœ¨**å®‰å…¨æ€§ã€é…ç½®ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–**ç­‰æ–¹é¢å­˜åœ¨ä¸€äº›éœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚å»ºè®®æŒ‰ç…§ä¼˜å…ˆçº§é€æ­¥æ”¹è¿›ï¼Œæé«˜ç³»ç»Ÿçš„**å®‰å…¨æ€§ã€ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§**ã€‚

**æ€»ä½“è¯„åˆ†**: 7.2/10

**æ”¹è¿›åé¢„æœŸè¯„åˆ†**: 8.5/10

---

## å…«ã€P0çº§é—®é¢˜ä¿®å¤æ€»ç»“

### 8.1 ä¿®å¤å®Œæˆæƒ…å†µ

æœ¬æ¬¡ä¿®å¤å…±å®Œæˆ**7ä¸ªP0çº§ä¸¥é‡é—®é¢˜**å’Œ**1ä¸ªP1çº§é«˜ä¼˜å…ˆçº§é—®é¢˜**çš„ä¿®å¤å·¥ä½œï¼š

| é—®é¢˜ID | é—®é¢˜æè¿° | ä¿®å¤çŠ¶æ€ | ä¿®å¤æ—¶é—´ |
|--------|----------|----------|----------|
| P0-1 | SecurityConfigå®Œå…¨æ”¾è¡Œ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-2 | CORSé…ç½®è¿‡äºå®½æ¾ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-3 | æ•°æ®åº“å¯†ç æ˜æ–‡å­˜å‚¨ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-4 | é‚®ä»¶å¯†ç æ˜æ–‡å­˜å‚¨ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-5 | APIå¯†é’¥æ˜æ–‡å­˜å‚¨ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-6 | APIå¯†é’¥å·²æ³„éœ²åˆ°Gitä»“åº“ | âœ… å·²è§£å†³ | 2026-01-12 |
| P0-7 | AIé…ç½®ç±»å†²çª | âœ… å·²è§£å†³ | 2026-01-12 |
| P1-1 | Milvusé…ç½®ç»´åº¦ä¸ä¸€è‡´ | âœ… å·²è§£å†³ | 2026-01-12 |

### 8.2 ä¿®å¤æ–‡ä»¶æ¸…å•

**ä¿®æ”¹çš„é…ç½®æ–‡ä»¶**:
- [SecurityConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\SecurityConfig.java) - ä¿®å¤è®¤è¯é…ç½®
- [WebConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\WebConfig.java) - ä¿®å¤CORSé…ç½®
- [application.yml](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\resources\application.yml) - æ·»åŠ CORSé…ç½®ï¼Œä¿®æ”¹æ•æ„Ÿä¿¡æ¯ä¸ºç¯å¢ƒå˜é‡
- [MilvusConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\MilvusConfig.java) - ä¿®å¤ç»´åº¦é…ç½®
- [AiServiceConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\AiServiceConfig.java) - ä¿®å¤ç»´åº¦é…ç½®

**åˆ é™¤çš„æ–‡ä»¶**:
- [AiConfig.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\config\AiConfig.java) - åˆ é™¤é‡å¤é…ç½®ç±»

**æ›´æ–°çš„æœåŠ¡ç±»**:
- [EmbeddingServiceImpl.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\service\impl\EmbeddingServiceImpl.java) - æ›´æ–°é…ç½®ç±»å¼•ç”¨
- [LlmServiceImpl.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\service\impl\LlmServiceImpl.java) - æ›´æ–°é…ç½®ç±»å¼•ç”¨
- [EnhancedLlmServiceImpl.java](file:///f:\CodeforJAVA\EchoCampus-Bot\backend\src\main\java\com\echocampus\bot\service\impl\EnhancedLlmServiceImpl.java) - æ›´æ–°é…ç½®ç±»å¼•ç”¨

### 8.3 ç¼–è¯‘éªŒè¯ç»“æœ

```
[INFO] BUILD SUCCESS
[INFO] Total time:  7.182 s
```

æ‰€æœ‰ä¿®æ”¹å·²é€šè¿‡ç¼–è¯‘éªŒè¯ï¼Œæ— ç¼–è¯‘é”™è¯¯ã€‚

### 8.4 åç»­æ“ä½œå»ºè®®

**å¿…é¡»æ‰§è¡Œçš„æ“ä½œ**:
1. **è®¾ç½®ç¯å¢ƒå˜é‡**
   åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚`.env`æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰ï¼š
   ```bash
   DB_PASSWORD=your_secure_password
   MAIL_PASSWORD=your_mail_password
   ALIYUN_API_KEY=your_aliyun_api_key
   DEEPSEEK_API_KEY=your_deepseek_api_key
   JWT_SECRET=your_jwt_secret_key
   ```

3. **å‰ç«¯é€‚é…**
   - ç¡®ä¿å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦æœ‰æ•ˆçš„JWT Token
   - æ£€æŸ¥CORSé…ç½®æ˜¯å¦ä¸å‰ç«¯åœ°å€åŒ¹é…

**å»ºè®®æ‰§è¡Œçš„æ“ä½œ**:
1. è¿è¡Œå®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ‰€æœ‰APIæ¥å£
3. æ£€æŸ¥å‰ç«¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸
4. ç›‘æ§ç³»ç»Ÿæ—¥å¿—ï¼Œç¡®ä¿æ— å¼‚å¸¸

### 8.5 å®‰å…¨æ€§æå‡

é€šè¿‡æœ¬æ¬¡ä¿®å¤ï¼Œç³»ç»Ÿçš„å®‰å…¨æ€§å¾—åˆ°æ˜¾è‘—æå‡ï¼š

- âœ… **è®¤è¯æœºåˆ¶**: ä»å®Œå…¨æ”¾è¡Œæ”¹ä¸ºåŸºäºJWTçš„è®¤è¯æœºåˆ¶
- âœ… **è·¨åŸŸæ§åˆ¶**: ä»å…è®¸æ‰€æœ‰æ¥æºæ”¹ä¸ºé…ç½®åŒ–çš„ç™½åå•æœºåˆ¶
- âœ… **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**: æ‰€æœ‰æ•æ„Ÿä¿¡æ¯æ”¹ä¸ºç¯å¢ƒå˜é‡å¼•ç”¨
- âœ… **é…ç½®ä¸€è‡´æ€§**: ç»Ÿä¸€å‘é‡ç»´åº¦é…ç½®ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- âœ… **ä»£ç è´¨é‡**: æ¶ˆé™¤é…ç½®ç±»å†²çªï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§

### 8.6 é£é™©æç¤º

**æ½œåœ¨é£é™©**:
1. SecurityConfigä¿®æ”¹åï¼Œæ‰€æœ‰éå…¬å¼€APIéƒ½éœ€è¦JWTè®¤è¯ï¼Œå¯èƒ½å¯¼è‡´ç°æœ‰å‰ç«¯è°ƒç”¨å¤±è´¥
2. CORSé…ç½®ä¿®æ”¹åï¼Œéœ€è¦ç¡®ä¿å‰ç«¯åœ°å€åœ¨å…è®¸åˆ—è¡¨ä¸­
3. ç¯å¢ƒå˜é‡é…ç½®éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼Œå¦åˆ™åº”ç”¨æ— æ³•å¯åŠ¨

**ç¼“è§£æªæ–½**:
1. åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
2. æä¾›è¯¦ç»†çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡æ¡£
3. ç›‘æ§åº”ç”¨å¯åŠ¨æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°é…ç½®é—®é¢˜

---

**å®¡æŸ¥äºº**: èµ„æ·±Java+Vueå…¨æ ˆå¼€å‘è€…  
**å®¡æŸ¥æ—¥æœŸ**: 2026-01-12  
**ä¿®å¤å®Œæˆæ—¥æœŸ**: 2026-01-12  
**ä¿®å¤äºº**: AIä»£ç åŠ©æ‰‹
