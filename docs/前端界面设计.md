# ITçŸ¥è¯†é—®ç­”æœºå™¨äºº - å‰ç«¯ç•Œé¢è®¾è®¡æ–‡æ¡£

## 1. æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Vue.js 3.3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶åº“**: Element Plus
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router 4
- **HTTPå®¢æˆ·ç«¯**: Axios
- **Markdownæ¸²æŸ“**: Marked + Highlight.js
- **æ ·å¼**: SCSS

## 2. é¡¹ç›®ç»“æ„

```
it-qabot-frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/                          # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”‚   â”œâ”€â”€ logo.png
â”‚   â”‚   â”‚   â””â”€â”€ avatar/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â”œâ”€â”€ global.scss
â”‚   â”‚       â”œâ”€â”€ variables.scss
â”‚   â”‚       â””â”€â”€ element-variables.scss
â”‚   â”œâ”€â”€ components/                      # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ChatMessage.vue              # èŠå¤©æ¶ˆæ¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ FileUpload.vue               # æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Pagination.vue               # åˆ†é¡µç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SearchBox.vue                # æœç´¢æ¡†ç»„ä»¶
â”‚   â”‚   â””â”€â”€ MarkdownViewer.vue           # Markdownæ¸²æŸ“ç»„ä»¶
â”‚   â”œâ”€â”€ views/                           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Chat.vue                     # èŠå¤©ä¸»é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Knowledge.vue                # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ Settings.vue                 # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ Login.vue                    # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ NotFound.vue                 # 404é¡µé¢
â”‚   â”œâ”€â”€ api/                             # APIæ¥å£
â”‚   â”‚   â”œâ”€â”€ index.ts                     # Axioså®ä¾‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.ts                      # è®¤è¯ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ chat.ts                      # èŠå¤©ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ knowledge.ts                 # çŸ¥è¯†åº“API
â”‚   â”‚   â””â”€â”€ system.ts                    # ç³»ç»Ÿé…ç½®API
â”‚   â”œâ”€â”€ stores/                          # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ user.ts                      # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ app.ts                       # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â””â”€â”€ chat.ts                      # èŠå¤©çŠ¶æ€
â”‚   â”œâ”€â”€ utils/                           # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts                   # Axiosè¯·æ±‚æ‹¦æˆª
â”‚   â”‚   â”œâ”€â”€ auth.ts                      # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ format.ts                    # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â””â”€â”€ constants.ts                 # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ types/                           # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.d.ts                     # APIæ¥å£ç±»å‹
â”‚   â”‚   â”œâ”€â”€ chat.d.ts                    # èŠå¤©ç›¸å…³ç±»å‹
â”‚   â”‚   â”œâ”€â”€ knowledge.d.ts               # çŸ¥è¯†åº“ç±»å‹
â”‚   â”‚   â””â”€â”€ user.d.ts                    # ç”¨æˆ·ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ router/                          # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ guards.ts                    # è·¯ç”±å®ˆå«
â”‚   â”œâ”€â”€ App.vue                          # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts                          # å…¥å£æ–‡ä»¶
â”œâ”€â”€ .env                                 # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.development
â”œâ”€â”€ .env.production
â”œâ”€â”€ vite.config.ts                       # Viteé…ç½®
â”œâ”€â”€ tsconfig.json                        # TypeScripté…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## 3. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 3.1 èŠå¤©æ¶ˆæ¯ç»„ä»¶ (ChatMessage.vue)

```vue
<template>
  <div :class="['chat-message', senderType]">
    <!-- å¤´åƒ -->
    <div class="avatar">
      <el-avatar :size="40" :src="avatar">
        <el-icon><User /></el-icon>
      </el-avatar>
    </div>
    
    <!-- æ¶ˆæ¯å†…å®¹ -->
    <div class="message-content">
      <div class="message-header">
        <span class="sender-name">{{ senderName }}</span>
        <span class="message-time">{{ formatTime(createdAt) }}</span>
      </div>
      
      <div class="message-body">
        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <div v-if="senderType === 'USER'" class="text-content">
          {{ content }}
        </div>
        
        <!-- AIæ¶ˆæ¯ -->
        <div v-else class="ai-message">
          <!-- Markdownå†…å®¹ -->
          <MarkdownViewer :content="content" />
          
          <!-- ç­”æ¡ˆæ¥æº -->
          <div v-if="sources && sources.length" class="sources">
            <el-divider>ç­”æ¡ˆæ¥æº</el-divider>
            <div v-for="source in sources" :key="source.docId" class="source-item">
              <el-link :underline="false" @click="viewSource(source)">
                <el-icon><Document /></el-icon>
                {{ source.title }}
                <el-tag size="small" type="info" style="margin-left: 8px;">
                  ç›¸ä¼¼åº¦: {{ (source.similarity * 100).toFixed(1) }}%
                </el-tag>
              </el-link>
            </div>
          </div>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <div class="message-actions">
            <el-button-group>
              <el-button size="small" :icon="Copy" @click="copyContent">
                å¤åˆ¶
              </el-button>
              <el-button size="small" :icon="Refresh" @click="regenerate">
                é‡æ–°ç”Ÿæˆ
              </el-button>
              <el-button size="small" :icon="Star" @click="toggleLike">
                {{ liked ? 'å·²ç‚¹èµ' : 'ç‚¹èµ' }}
              </el-button>
            </el-button-group>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { ElMessage } from 'element-plus'
import { User, Document, Copy, Refresh, Star } from '@element-plus/icons-vue'
import MarkdownViewer from './MarkdownViewer.vue'
import { useUserStore } from '@/stores/user'
import { formatTime } from '@/utils/format'
import { copyToClipboard } from '@/utils/common'

interface Props {
  id: number
  senderType: 'USER' | 'BOT' | 'SYSTEM'
  content: string
  createdAt: string
  sources?: Source[]
  metadata?: Record<string, any>
}

const props = defineProps<Props>()

const userStore = useUserStore()
const liked = ref(false)

const avatar = computed(() => {
  return props.senderType === 'USER' 
    ? userStore.userInfo?.avatar 
    : '/assets/avatar/bot.png'
})

const senderName = computed(() => {
  return props.senderType === 'USER' 
    ? userStore.userInfo?.nickname || 'æˆ‘'
    : 'AIåŠ©æ‰‹'
})

const copyContent = async () => {
  try {
    await copyToClipboard(props.content)
    ElMessage.success('å¤åˆ¶æˆåŠŸ')
  } catch (error) {
    ElMessage.error('å¤åˆ¶å¤±è´¥')
  }
}

const regenerate = () => {
  emit('regenerate', props.id)
}

const toggleLike = () => {
  liked.value = !liked.value
  ElMessage.success(liked.value ? 'å·²ç‚¹èµ' : 'å–æ¶ˆç‚¹èµ')
}

const viewSource = (source: Source) => {
  emit('viewSource', source)
}

const emit = defineEmits<{
  regenerate: [messageId: number]
  viewSource: [source: Source]
}>()
</script>

<style scoped lang="scss">
.chat-message {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  
  &.USER {
    flex-direction: row-reverse;
    
    .message-content {
      align-items: flex-end;
    }
    
    .message-body {
      background-color: #95ec69;
      color: #000;
    }
  }
  
  &.BOT {
    .message-content {
      align-items: flex-start;
    }
    
    .message-body {
      background-color: #fff;
      border: 1px solid #e4e7ed;
    }
  }
  
  .avatar {
    flex-shrink: 0;
  }
  
  .message-content {
    flex: 1;
    max-width: calc(100% - 60px);
    
    .message-header {
      margin-bottom: 8px;
      font-size: 12px;
      color: #909399;
      
      .sender-name {
        margin-right: 8px;
      }
    }
    
    .message-body {
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.6;
      
      .sources {
        margin-top: 16px;
        padding-top: 12px;
        
        .source-item {
          margin-bottom: 8px;
        }
      }
      
      .message-actions {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
      }
    }
  }
}
</style>
```

### 3.2 Markdownæ¸²æŸ“ç»„ä»¶ (MarkdownViewer.vue)

```vue
<template>
  <div class="markdown-viewer" v-html="renderedContent"></div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { marked } from 'marked'
import hljs from 'highlight.js'
import 'highlight.js/styles/github.css'

interface Props {
  content: string
}

const props = defineProps<Props>()

// é…ç½®marked
marked.setOptions({
  highlight: function(code, lang) {
    if (lang && hljs.getLanguage(lang)) {
      try {
        return hljs.highlight(code, { language: lang }).value
      } catch (err) {
        console.error('Highlight error:', err)
      }
    }
    return hljs.highlightAuto(code).value
  },
  breaks: true,
  gfm: true
})

const renderedContent = computed(() => {
  return marked(props.content)
})
</script>

<style scoped lang="scss">
.markdown-viewer {
  :deep(h1), :deep(h2), :deep(h3), :deep(h4), :deep(h5), :deep(h6) {
    margin: 16px 0 12px 0;
    color: #303133;
  }
  
  :deep(p) {
    margin: 8px 0;
    line-height: 1.6;
  }
  
  :deep(ul), :deep(ol) {
    margin: 8px 0;
    padding-left: 24px;
  }
  
  :deep(li) {
    margin: 4px 0;
  }
  
  :deep(code) {
    background-color: #f4f4f5;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 0.9em;
  }
  
  :deep(pre) {
    background-color: #f6f8fa;
    padding: 16px;
    border-radius: 8px;
    overflow-x: auto;
    margin: 12px 0;
    
    code {
      background: none;
      padding: 0;
    }
  }
  
  :deep(blockquote) {
    border-left: 4px solid #409eff;
    padding-left: 16px;
    margin: 12px 0;
    color: #606266;
    font-style: italic;
  }
  
  :deep(table) {
    border-collapse: collapse;
    width: 100%;
    margin: 12px 0;
    
    th, td {
      border: 1px solid #e4e7ed;
      padding: 8px 12px;
      text-align: left;
    }
    
    th {
      background-color: #f5f7fa;
      font-weight: 600;
    }
  }
}
</style>
```

### 3.3 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ (FileUpload.vue)

```vue
<template>
  <div class="file-upload">
    <el-upload
      ref="uploadRef"
      class="upload-area"
      drag
      :action="uploadUrl"
      :headers="uploadHeaders"
      :data="uploadData"
      :accept="acceptTypes"
      :limit="limit"
      :file-list="fileList"
      :auto-upload="autoUpload"
      :before-upload="beforeUpload"
      :on-progress="handleProgress"
      :on-success="handleSuccess"
      :on-error="handleError"
      :on-remove="handleRemove"
    >
      <el-icon class="el-icon--upload"><upload-filled /></el-icon>
      <div class="el-upload__text">
        æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ– <em>ç‚¹å‡»ä¸Šä¼ </em>
      </div>
      <template #tip>
        <div class="el-upload__tip">
          æ”¯æŒ {{ acceptTypes }} æ ¼å¼, å•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ {{ maxSize }}MB
        </div>
      </template>
    </el-upload>
    
    <!-- ä¸Šä¼ è¿›åº¦ -->
    <el-progress 
      v-if="uploading" 
      :percentage="uploadPercentage" 
      :status="uploadStatus"
      style="margin-top: 16px;"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { ElMessage, ElUpload } from 'element-plus'
import { UploadFilled } from '@element-plus/icons-vue'
import { getToken } from '@/utils/auth'

interface Props {
  accept?: string
  limit?: number
  maxSize?: number  // MB
  autoUpload?: boolean
  uploadData?: Record<string, any>
}

const props = withDefaults(defineProps<Props>(), {
  accept: '.pdf,.txt,.md,.docx,.doc',
  limit: 1,
  maxSize: 10,
  autoUpload: true,
  uploadData: () => ({})
})

const uploadRef = ref<InstanceType<typeof ElUpload>>()
const fileList = ref<any[]>([])
const uploading = ref(false)
const uploadPercentage = ref(0)
const uploadStatus = ref<'success' | 'exception' | 'warning'>('success')

const uploadUrl = computed(() => `${import.meta.env.VITE_API_BASE_URL}/knowledge/docs`)

const uploadHeaders = computed(() => ({
  Authorization: `Bearer ${getToken()}`
}))

const acceptTypes = computed(() => props.accept)

const beforeUpload = (file: File) => {
  const isLtMaxSize = file.size / 1024 / 1024 < props.maxSize!
  if (!isLtMaxSize) {
    ElMessage.error(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${props.maxSize}MB!`)
    return false
  }
  
  const fileExtension = file.name.split('.').pop()?.toLowerCase()
  const allowedTypes = props.accept!.split(',').map(type => type.trim().replace('.', ''))
  
  if (!allowedTypes.includes(fileExtension!)) {
    ElMessage.error(`æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®,è¯·ä¸Šä¼  ${props.accept} æ ¼å¼çš„æ–‡ä»¶`)
    return false
  }
  
  return true
}

const handleProgress = (event: any, file: any, fileList: any[]) => {
  uploading.value = true
  uploadPercentage.value = Math.round(event.percent)
}

const handleSuccess = (response: any, file: any, fileList: any[]) => {
  uploading.value = false
  uploadStatus.value = 'success'
  ElMessage.success('ä¸Šä¼ æˆåŠŸ')
  emit('success', response, file)
}

const handleError = (error: any, file: any, fileList: any[]) => {
  uploading.value = false
  uploadStatus.value = 'exception'
  ElMessage.error('ä¸Šä¼ å¤±è´¥')
  emit('error', error, file)
}

const handleRemove = (file: any, fileList: any[]) => {
  emit('remove', file)
}

const clearFiles = () => {
  uploadRef.value?.clearFiles()
}

const submitUpload = () => {
  uploadRef.value?.submit()
}

const emit = defineEmits<{
  success: [response: any, file: any]
  error: [error: any, file: any]
  remove: [file: any]
}>()

defineExpose({
  clearFiles,
  submitUpload
})
</script>

<style scoped lang="scss">
.file-upload {
  .upload-area {
    :deep(.el-upload-dragger) {
      padding: 40px 20px;
    }
  }
}
</style>
```

## 4. é¡µé¢è®¾è®¡

### 4.1 èŠå¤©ä¸»é¡µé¢ (Chat.vue)

```vue
<template>
  <div class="chat-page">
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
      <div class="sidebar-header">
        <el-button 
          type="primary" 
          :icon="Plus" 
          @click="createNewConversation"
          style="width: 100%;"
        >
          æ–°å»ºå¯¹è¯
        </el-button>
      </div>
      
      <div class="conversation-list">
        <div 
          v-for="conv in conversations" 
          :key="conv.id"
          :class="['conversation-item', { active: currentConversation?.id === conv.id }]"
          @click="selectConversation(conv)"
        >
          <div class="conv-title">{{ conv.title }}</div>
          <div class="conv-info">
            <span>{{ formatTime(conv.updatedAt) }}</span>
            <el-dropdown @command="handleConvCommand($event, conv)">
              <el-icon class="more-icon"><More /></el-icon>
              <template #dropdown>
                <el-dropdown-menu>
                  <el-dropdown-item command="rename">é‡å‘½å</el-dropdown-item>
                  <el-dropdown-item command="delete">åˆ é™¤</el-dropdown-item>
                </el-dropdown-menu>
              </template>
            </el-dropdown>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ä¸»èŠå¤©åŒºåŸŸ -->
    <div class="main-chat">
      <!-- é¡¶éƒ¨å·¥å…·æ  -->
      <div class="chat-header">
        <el-button 
          :icon="Menu" 
          @click="toggleSidebar"
          circle
        />
        
        <div class="chat-title">
          {{ currentConversation?.title || 'æ–°å»ºå¯¹è¯' }}
        </div>
        
        <div class="chat-actions">
          <el-button :icon="Refresh" @click="refreshConversation">
            åˆ·æ–°
          </el-button>
        </div>
      </div>
      
      <!-- æ¶ˆæ¯åˆ—è¡¨ -->
      <div class="message-container" ref="messageContainer">
        <div v-if="!messages.length" class="welcome-message">
          <h2>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ITçŸ¥è¯†é—®ç­”æœºå™¨äºº</h2>
          <p>æˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”å„ç§ITç›¸å…³é—®é¢˜,åŒ…æ‹¬ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶æŠ€æœ¯ã€æ•°æ®åº“ç­‰ã€‚</p>
          <div class="quick-questions">
            <el-button 
              v-for="question in quickQuestions" 
              :key="question"
              @click="quickAsk(question)"
              plain
            >
              {{ question }}
            </el-button>
          </div>
        </div>
        
        <ChatMessage
          v-for="message in messages"
          :key="message.id"
          :id="message.id"
          :sender-type="message.senderType"
          :content="message.content"
          :created-at="message.createdAt"
          :sources="message.sources"
          :metadata="message.metadata"
          @regenerate="regenerateMessage"
          @viewSource="viewSource"
        />
        
        <!-- æ­£åœ¨è¾“å…¥æç¤º -->
        <div v-if="aiTyping" class="ai-typing">
          <el-icon class="typing-icon"><Loading /></el-icon>
          AIæ­£åœ¨æ€è€ƒä¸­...
        </div>
      </div>
      
      <!-- è¾“å…¥åŒºåŸŸ -->
      <div class="input-area">
        <el-input
          v-model="inputMessage"
          type="textarea"
          :rows="3"
          placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
          resize="none"
          :disabled="aiTyping"
          @keydown.enter.prevent="handleSendMessage"
        />
        
        <div class="input-actions">
          <div class="input-info">
            <span v-if="inputMessage">{{ inputMessage.length }} å­—ç¬¦</span>
          </div>
          
          <div class="input-buttons">
            <el-button 
              :icon="Delete" 
              @click="clearMessages"
              :disabled="!messages.length"
            >
              æ¸…ç©º
            </el-button>
            <el-button 
              type="primary" 
              :icon="Position"
              @click="handleSendMessage"
              :disabled="!inputMessage.trim() || aiTyping"
              :loading="aiTyping"
            >
              å‘é€
            </el-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { 
  Plus, Menu, More, Refresh, Delete, Position, Loading 
} from '@element-plus/icons-vue'
import ChatMessage from '@/components/ChatMessage.vue'
import { useChatStore } from '@/stores/chat'
import { useUserStore } from '@/stores/user'
import { formatTime } from '@/utils/format'
import type { Conversation, Message } from '@/types/chat'

const chatStore = useChatStore()
const userStore = useUserStore()

// å“åº”å¼æ•°æ®
const sidebarCollapsed = ref(false)
const inputMessage = ref('')
const aiTyping = ref(false)
const messageContainer = ref<HTMLElement>()

// å¿«é€Ÿé—®é¢˜ç¤ºä¾‹
const quickQuestions = [
  'ä»€ä¹ˆæ˜¯Spring Boot?',
  'Javaä¸­çš„å¤šçº¿ç¨‹å¦‚ä½•å®ç°?',
  'MySQLç´¢å¼•ä¼˜åŒ–æœ‰å“ªäº›æ–¹æ³•?',
  'Vue3å’ŒVue2æœ‰ä»€ä¹ˆåŒºåˆ«?'
]

// è®¡ç®—å±æ€§
const conversations = computed(() => chatStore.conversations)
const currentConversation = computed(() => chatStore.currentConversation)
const messages = computed(() => chatStore.messages)

// ç”Ÿå‘½å‘¨æœŸ
onMounted(async () => {
  await chatStore.fetchConversations()
})

// æ–¹æ³•
const toggleSidebar = () => {
  sidebarCollapsed.value = !sidebarCollapsed.value
}

const createNewConversation = async () => {
  await chatStore.createConversation()
  scrollToBottom()
}

const selectConversation = async (conv: Conversation) => {
  await chatStore.selectConversation(conv.id)
  scrollToBottom()
}

const handleSendMessage = async () => {
  if (!inputMessage.value.trim() || aiTyping.value) return
  
  const message = inputMessage.value.trim()
  inputMessage.value = ''
  
  try {
    aiTyping.value = true
    await chatStore.sendMessage(message)
    scrollToBottom()
  } catch (error) {
    ElMessage.error('å‘é€å¤±è´¥,è¯·é‡è¯•')
  } finally {
    aiTyping.value = false
  }
}

const quickAsk = (question: string) => {
  inputMessage.value = question
  handleSendMessage()
}

const regenerateMessage = async (messageId: number) => {
  try {
    aiTyping.value = true
    await chatStore.regenerateMessage(messageId)
  } catch (error) {
    ElMessage.error('é‡æ–°ç”Ÿæˆå¤±è´¥')
  } finally {
    aiTyping.value = false
  }
}

const clearMessages = () => {
  ElMessageBox.confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—?', 'æç¤º', {
    confirmButtonText: 'ç¡®å®š',
    cancelButtonText: 'å–æ¶ˆ',
    type: 'warning'
  }).then(() => {
    chatStore.clearCurrentConversation()
  })
}

const scrollToBottom = () => {
  nextTick(() => {
    if (messageContainer.value) {
      messageContainer.value.scrollTop = messageContainer.value.scrollHeight
    }
  })
}

const handleConvCommand = (command: string, conv: Conversation) => {
  if (command === 'rename') {
    ElMessageBox.prompt('è¯·è¾“å…¥æ–°çš„å¯¹è¯æ ‡é¢˜', 'é‡å‘½å', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      inputValue: conv.title
    }).then(({ value }) => {
      if (value && value.trim()) {
        chatStore.updateConversationTitle(conv.id, value.trim())
      }
    })
  } else if (command === 'delete') {
    ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—?', 'åˆ é™¤å¯¹è¯', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    }).then(() => {
      chatStore.deleteConversation(conv.id)
    })
  }
}

const refreshConversation = () => {
  if (currentConversation.value) {
    chatStore.fetchMessages(currentConversation.value.id)
  }
}

const viewSource = (source: any) => {
  // æŸ¥çœ‹æ¥æºè¯¦æƒ…
  console.log('View source:', source)
}
</script>

<style scoped lang="scss">
.chat-page {
  display: flex;
  height: 100vh;
  
  .sidebar {
    width: 280px;
    background-color: #f5f7fa;
    border-right: 1px solid #e4e7ed;
    display: flex;
    flex-direction: column;
    transition: width 0.3s;
    
    &.collapsed {
      width: 0;
      overflow: hidden;
    }
    
    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #e4e7ed;
    }
    
    .conversation-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
      
      .conversation-item {
        padding: 12px;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 4px;
        transition: background-color 0.2s;
        
        &:hover {
          background-color: #e6f7ff;
        }
        
        &.active {
          background-color: #409eff;
          color: white;
        }
        
        .conv-title {
          font-weight: 500;
          margin-bottom: 4px;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }
        
        .conv-info {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 12px;
          opacity: 0.7;
          
          .more-icon {
            opacity: 0;
            transition: opacity 0.2s;
          }
          
          &:hover .more-icon {
            opacity: 1;
          }
        }
      }
    }
  }
  
  .main-chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    
    .chat-header {
      height: 60px;
      padding: 0 20px;
      border-bottom: 1px solid #e4e7ed;
      display: flex;
      align-items: center;
      gap: 16px;
      
      .chat-title {
        flex: 1;
        font-size: 18px;
        font-weight: 500;
      }
    }
    
    .message-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      
      .welcome-message {
        text-align: center;
        padding: 60px 20px;
        
        h2 {
          margin-bottom: 16px;
          color: #303133;
        }
        
        p {
          color: #606266;
          margin-bottom: 24px;
        }
        
        .quick-questions {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          justify-content: center;
        }
      }
      
      .ai-typing {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background-color: #fff;
        border: 1px solid #e4e7ed;
        border-radius: 12px;
        margin-bottom: 20px;
        
        .typing-icon {
          animation: rotating 2s linear infinite;
        }
      }
    }
    
    .input-area {
      padding: 16px 20px;
      border-top: 1px solid #e4e7ed;
      background-color: #fafafa;
      
      .input-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        
        .input-info {
          color: #909399;
          font-size: 12px;
        }
        
        .input-buttons {
          display: flex;
          gap: 8px;
        }
      }
    }
  }
}

@keyframes rotating {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</style>
```

### 4.2 çŸ¥è¯†åº“ç®¡ç†é¡µé¢ (Knowledge.vue)

```vue
<template>
  <div class="knowledge-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>çŸ¥è¯†åº“ç®¡ç†</h1>
      <el-button type="primary" :icon="Plus" @click="showUploadDialog = true">
        ä¸Šä¼ æ–‡æ¡£
      </el-button>
    </div>
    
    <!-- æœç´¢å’Œç­›é€‰ -->
    <div class="filter-bar">
      <el-form :inline="true" :model="filterForm">
        <el-form-item label="åˆ†ç±»">
          <el-select v-model="filterForm.category" placeholder="å…¨éƒ¨åˆ†ç±»" clearable>
            <el-option
              v-for="cat in categories"
              :key="cat.id"
              :label="cat.name"
              :value="cat.id"
            />
          </el-select>
        </el-form-item>
        
        <el-form-item label="çŠ¶æ€">
          <el-select v-model="filterForm.status" placeholder="å…¨éƒ¨çŠ¶æ€" clearable>
            <el-option label="å¯ç”¨" value="ACTIVE" />
            <el-option label="ç¦ç”¨" value="INACTIVE" />
            <el-option label="å¤„ç†ä¸­" value="PROCESSING" />
            <el-option label="å¤±è´¥" value="FAILED" />
          </el-select>
        </el-form-item>
        
        <el-form-item>
          <el-input
            v-model="filterForm.keyword"
            placeholder="æœç´¢æ–‡æ¡£æ ‡é¢˜æˆ–æè¿°"
            clearable
            style="width: 300px;"
          >
            <template #prefix>
              <el-icon><Search /></el-icon>
            </template>
          </el-input>
        </el-form-item>
        
        <el-form-item>
          <el-button type="primary" :icon="Search" @click="handleSearch">
            æœç´¢
          </el-button>
          <el-button @click="resetFilter">é‡ç½®</el-button>
        </el-form-item>
      </el-form>
    </div>
    
    <!-- æ–‡æ¡£åˆ—è¡¨ -->
    <div class="document-list">
      <el-card
        v-for="doc in documentList"
        :key="doc.id"
        class="document-card"
        shadow="hover"
      >
        <div class="doc-header">
          <div class="doc-icon">
            <el-icon :size="48">
              <Document v-if="doc.fileType === 'pdf'" />
              <Tickets v-else-if="doc.fileType === 'txt'" />
              <DocumentCopy v-else-if="doc.fileType === 'md'" />
              <Files v-else />
            </el-icon>
          </div>
          
          <div class="doc-info">
            <h3 class="doc-title">{{ doc.title }}</h3>
            <p class="doc-desc">{{ doc.description || 'æš‚æ— æè¿°' }}</p>
            
            <div class="doc-meta">
              <el-tag size="small" type="info">
                {{ doc.categoryName }}
              </el-tag>
              <el-tag 
                size="small" 
                :type="getStatusType(doc.status)"
                style="margin-left: 8px;"
              >
                {{ getStatusLabel(doc.status) }}
              </el-tag>
              <span class="doc-size">{{ formatFileSize(doc.fileSize) }}</span>
              <span class="doc-vectors">{{ doc.vectorCount }} ä¸ªç‰‡æ®µ</span>
            </div>
          </div>
          
          <div class="doc-actions">
            <el-button-group>
              <el-button 
                :icon="View" 
                size="small"
                @click="viewDocument(doc)"
              >
                é¢„è§ˆ
              </el-button>
              <el-button 
                :icon="Edit" 
                size="small"
                @click="editDocument(doc)"
              >
                ç¼–è¾‘
              </el-button>
              <el-dropdown @command="handleDocCommand($event, doc)">
                <el-button :icon="More" size="small" />
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="reindex">é‡æ–°ç´¢å¼•</el-dropdown-item>
                    <el-dropdown-item command="download">ä¸‹è½½</el-dropdown-item>
                    <el-dropdown-item command="delete" divided>åˆ é™¤</el-dropdown-item>
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </el-button-group>
          </div>
        </div>
        
        <div class="doc-footer">
          <span class="doc-time">
            ä¸Šä¼ æ—¶é—´: {{ formatTime(doc.createdAt) }}
          </span>
          <span class="doc-creator">
            ä¸Šä¼ è€…: {{ doc.creatorName }}
          </span>
        </div>
      </el-card>
      
      <!-- ç©ºçŠ¶æ€ -->
      <el-empty 
        v-if="!documentList.length && !loading" 
        description="æš‚æ— æ–‡æ¡£"
        style="margin-top: 60px;"
      />
    </div>
    
    <!-- åˆ†é¡µ -->
    <div class="pagination">
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handlePageChange"
      />
    </div>
    
    <!-- ä¸Šä¼ å¯¹è¯æ¡† -->
    <el-dialog
      v-model="showUploadDialog"
      title="ä¸Šä¼ æ–‡æ¡£"
      width="600px"
      :close-on-click-modal="false"
    >
      <FileUpload
        ref="fileUploadRef"
        @success="handleUploadSuccess"
        @error="handleUploadError"
      />
      
      <el-form :model="uploadForm" label-width="80px" style="margin-top: 20px;">
        <el-form-item label="æ ‡é¢˜">
          <el-input v-model="uploadForm.title" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜" />
        </el-form-item>
        <el-form-item label="æè¿°">
          <el-input 
            v-model="uploadForm.description" 
            type="textarea" 
            :rows="3"
            placeholder="è¯·è¾“å…¥æ–‡æ¡£æè¿°"
          />
        </el-form-item>
        <el-form-item label="åˆ†ç±»">
          <el-select v-model="uploadForm.category" placeholder="è¯·é€‰æ‹©åˆ†ç±»">
            <el-option
              v-for="cat in categories"
              :key="cat.id"
              :label="cat.name"
              :value="cat.id"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="æ ‡ç­¾">
          <el-input v-model="uploadForm.tags" placeholder="è¯·è¾“å…¥æ ‡ç­¾,ç”¨é€—å·åˆ†éš”" />
        </el-form-item>
      </el-form>
      
      <template #footer>
        <el-button @click="showUploadDialog = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="submitUpload">ç¡®å®š</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { 
  Plus, Search, Document, Tickets, DocumentCopy, Files,
  View, Edit, More, Download, Delete
} from '@element-plus/icons-vue'
import FileUpload from '@/components/FileUpload.vue'
import { useKnowledgeStore } from '@/stores/knowledge'
import { formatTime, formatFileSize } from '@/utils/format'
import type { KnowledgeDoc } from '@/types/knowledge'

const knowledgeStore = useKnowledgeStore()

// å“åº”å¼æ•°æ®
const loading = ref(false)
const showUploadDialog = ref(false)
const fileUploadRef = ref<InstanceType<typeof FileUpload>>()

// ç­›é€‰è¡¨å•
const filterForm = ref({
  category: '',
  status: '',
  keyword: ''
})

// ä¸Šä¼ è¡¨å•
const uploadForm = ref({
  title: '',
  description: '',
  category: '',
  tags: ''
})

// åˆ†é¡µ
const pagination = ref({
  page: 1,
  size: 10,
  total: 0
})

// è®¡ç®—å±æ€§
const documentList = computed(() => knowledgeStore.documents)
const categories = computed(() => knowledgeStore.categories)

// ç”Ÿå‘½å‘¨æœŸ
onMounted(async () => {
  await loadData()
  await knowledgeStore.fetchCategories()
})

// æ–¹æ³•
const loadData = async () => {
  loading.value = true
  try {
    const params = {
      page: pagination.value.page,
      size: pagination.value.size,
      ...filterForm.value
    }
    const result = await knowledgeStore.fetchDocuments(params)
    pagination.value.total = result.total
  } catch (error) {
    ElMessage.error('åŠ è½½å¤±è´¥')
  } finally {
    loading.value = false
  }
}

const handleSearch = () => {
  pagination.value.page = 1
  loadData()
}

const resetFilter = () => {
  filterForm.value = {
    category: '',
    status: '',
    keyword: ''
  }
  handleSearch()
}

const handlePageChange = (page: number) => {
  pagination.value.page = page
  loadData()
}

const handleSizeChange = (size: number) => {
  pagination.value.size = size
  pagination.value.page = 1
  loadData()
}

const getStatusType = (status: string) => {
  const types: Record<string, any> = {
    ACTIVE: 'success',
    INACTIVE: 'info',
    PROCESSING: 'warning',
    FAILED: 'danger'
  }
  return types[status] || 'info'
}

const getStatusLabel = (status: string) => {
  const labels: Record<string, string> = {
    ACTIVE: 'å¯ç”¨',
    INACTIVE: 'ç¦ç”¨',
    PROCESSING: 'å¤„ç†ä¸­',
    FAILED: 'å¤±è´¥'
  }
  return labels[status] || status
}

const viewDocument = (doc: KnowledgeDoc) => {
  // æ‰“å¼€æ–‡æ¡£é¢„è§ˆå¯¹è¯æ¡†
  console.log('View document:', doc)
}

const editDocument = (doc: KnowledgeDoc) => {
  // æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†
  console.log('Edit document:', doc)
}

const handleDocCommand = (command: string, doc: KnowledgeDoc) => {
  switch (command) {
    case 'reindex':
      reindexDocument(doc)
      break
    case 'download':
      downloadDocument(doc)
      break
    case 'delete':
      deleteDocument(doc)
      break
  }
}

const reindexDocument = async (doc: KnowledgeDoc) => {
  try {
    await knowledgeStore.reindexDocument(doc.id)
    ElMessage.success('é‡æ–°ç´¢å¼•å·²å¯åŠ¨')
  } catch (error) {
    ElMessage.error('æ“ä½œå¤±è´¥')
  }
}

const downloadDocument = (doc: KnowledgeDoc) => {
  // ä¸‹è½½æ–‡æ¡£
  console.log('Download document:', doc)
}

const deleteDocument = async (doc: KnowledgeDoc) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡æ¡£å—?', 'åˆ é™¤æ–‡æ¡£', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await knowledgeStore.deleteDocument(doc.id)
    ElMessage.success('åˆ é™¤æˆåŠŸ')
    loadData()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}

const handleUploadSuccess = (response: any) => {
  ElMessage.success('ä¸Šä¼ æˆåŠŸ,æ­£åœ¨å¤„ç†ä¸­...')
  uploadForm.value = {
    title: '',
    description: '',
    category: '',
    tags: ''
  }
  showUploadDialog.value = false
  loadData()
}

const handleUploadError = (error: any) => {
  ElMessage.error('ä¸Šä¼ å¤±è´¥')
}

const submitUpload = () => {
  fileUploadRef.value?.submitUpload()
}
</script>

<style scoped lang="scss">
.knowledge-page {
  padding: 20px;
  
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    
    h1 {
      margin: 0;
      color: #303133;
    }
  }
  
  .filter-bar {
    background-color: #f5f7fa;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .document-list {
    .document-card {
      margin-bottom: 16px;
      
      .doc-header {
        display: flex;
        gap: 16px;
        align-items: flex-start;
        
        .doc-icon {
          flex-shrink: 0;
          color: #409eff;
        }
        
        .doc-info {
          flex: 1;
          
          .doc-title {
            margin: 0 0 8px 0;
            color: #303133;
          }
          
          .doc-desc {
            margin: 0 0 12px 0;
            color: #606266;
            font-size: 14px;
            line-height: 1.5;
          }
          
          .doc-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            
            .doc-size, .doc-vectors {
              color: #909399;
              font-size: 12px;
            }
          }
        }
        
        .doc-actions {
          flex-shrink: 0;
        }
      }
      
      .doc-footer {
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid #e4e7ed;
        display: flex;
        justify-content: space-between;
        color: #909399;
        font-size: 12px;
      }
    }
  }
  
  .pagination {
    margin-top: 24px;
    display: flex;
    justify-content: center;
  }
}
</style>
```

## 5. çŠ¶æ€ç®¡ç† (Pinia)

### 5.1 èŠå¤©çŠ¶æ€ (stores/chat.ts)

```typescript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { Conversation, Message } from '@/types/chat'
import { chatApi } from '@/api/chat'

export const useChatStore = defineStore('chat', () => {
  // çŠ¶æ€
  const conversations = ref<Conversation[]>([])
  const currentConversation = ref<Conversation | null>(null)
  const messages = ref<Message[]>([])
  
  // è®¡ç®—å±æ€§
  const conversationCount = computed(() => conversations.value.length)
  
  // æ–¹æ³•
  const fetchConversations = async () => {
    try {
      const response = await chatApi.getConversations()
      conversations.value = response.data.list
      return response.data
    } catch (error) {
      console.error('Failed to fetch conversations:', error)
      throw error
    }
  }
  
  const createConversation = async () => {
    try {
      const response = await chatApi.createConversation()
      const newConv = response.data
      conversations.value.unshift(newConv)
      currentConversation.value = newConv
      messages.value = []
      return newConv
    } catch (error) {
      console.error('Failed to create conversation:', error)
      throw error
    }
  }
  
  const selectConversation = async (conversationId: number) => {
    const conv = conversations.value.find(c => c.id === conversationId)
    if (conv) {
      currentConversation.value = conv
      await fetchMessages(conversationId)
    }
  }
  
  const fetchMessages = async (conversationId: number) => {
    try {
      const response = await chatApi.getMessages(conversationId)
      messages.value = response.data.list
      return response.data
    } catch (error) {
      console.error('Failed to fetch messages:', error)
      throw error
    }
  }
  
  const sendMessage = async (content: string) => {
    if (!currentConversation.value) {
      await createConversation()
    }
    
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const userMessage: Message = {
      id: Date.now(),
      conversationId: currentConversation.value!.id,
      senderType: 'USER',
      content,
      createdAt: new Date().toISOString()
    }
    messages.value.push(userMessage)
    
    try {
      // è°ƒç”¨APIè·å–AIå›ç­”
      const response = await chatApi.sendMessage({
        conversationId: currentConversation.value!.id,
        message: content
      })
      
      // æ·»åŠ AIæ¶ˆæ¯
      const aiMessage: Message = {
        id: response.data.messageId,
        conversationId: currentConversation.value!.id,
        senderType: 'BOT',
        content: response.data.answer,
        sources: response.data.sources,
        metadata: {
          usage: response.data.usage
        },
        createdAt: new Date().toISOString()
      }
      messages.value.push(aiMessage)
      
      return response.data
    } catch (error) {
      // ç§»é™¤ç”¨æˆ·æ¶ˆæ¯
      messages.value = messages.value.filter(m => m.id !== userMessage.id)
      throw error
    }
  }
  
  const updateConversationTitle = async (conversationId: number, title: string) => {
    try {
      await chatApi.updateConversationTitle(conversationId, { title })
      
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      const conv = conversations.value.find(c => c.id === conversationId)
      if (conv) {
        conv.title = title
      }
      
      if (currentConversation.value?.id === conversationId) {
        currentConversation.value.title = title
      }
    } catch (error) {
      console.error('Failed to update conversation title:', error)
      throw error
    }
  }
  
  const deleteConversation = async (conversationId: number) => {
    try {
      await chatApi.deleteConversation(conversationId)
      
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      conversations.value = conversations.value.filter(c => c.id !== conversationId)
      
      if (currentConversation.value?.id === conversationId) {
        currentConversation.value = null
        messages.value = []
      }
    } catch (error) {
      console.error('Failed to delete conversation:', error)
      throw error
    }
  }
  
  const clearCurrentConversation = () => {
    messages.value = []
  }
  
  return {
    // çŠ¶æ€
    conversations,
    currentConversation,
    messages,
    
    // è®¡ç®—å±æ€§
    conversationCount,
    
    // æ–¹æ³•
    fetchConversations,
    createConversation,
    selectConversation,
    fetchMessages,
    sendMessage,
    updateConversationTitle,
    deleteConversation,
    clearCurrentConversation
  }
})
```

## 6. APIæ¥å£å°è£…

### 6.1 Axiosé…ç½® (api/index.ts)

```typescript
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios'
import { ElMessage } from 'element-plus'
import { getToken, removeToken } from '@/utils/auth'
import { useUserStore } from '@/stores/user'

// åˆ›å»ºaxioså®ä¾‹
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    // æ·»åŠ token
    const token = getToken()
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  (error) => {
    console.error('Request error:', error)
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data
    
    if (code === 200) {
      return response.data
    } else {
      ElMessage.error(message || 'è¯·æ±‚å¤±è´¥')
      
      // å¤„ç†ç‰¹å®šé”™è¯¯ç 
      if (code === 401) {
        removeToken()
        window.location.reload()
      }
      
      return Promise.reject(new Error(message || 'Error'))
    }
  },
  (error) => {
    console.error('Response error:', error)
    
    let message = 'ç½‘ç»œé”™è¯¯'
    if (error.response) {
      message = error.response.data?.message || `é”™è¯¯ç : ${error.response.status}`
    } else if (error.request) {
      message = 'è¯·æ±‚è¶…æ—¶,è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'
    }
    
    ElMessage.error(message)
    return Promise.reject(error)
  }
)

export default service
```

### 6.2 èŠå¤©API (api/chat.ts)

```typescript
import service from './index'
import type { ChatRequest, ChatResponse } from '@/types/chat'

export const chatApi = {
  // è·å–å¯¹è¯åˆ—è¡¨
  getConversations(params?: { page?: number; size?: number; status?: string }) {
    return service.get('/chat/conversations', { params })
  },
  
  // åˆ›å»ºæ–°å¯¹è¯
  createConversation() {
    return service.post('/chat/conversations')
  },
  
  // è·å–å¯¹è¯è¯¦æƒ…
  getConversation(conversationId: number) {
    return service.get(`/chat/conversations/${conversationId}`)
  },
  
  // æ›´æ–°å¯¹è¯æ ‡é¢˜
  updateConversationTitle(conversationId: number, data: { title: string }) {
    return service.put(`/chat/conversations/${conversationId}/title`, data)
  },
  
  // åˆ é™¤å¯¹è¯
  deleteConversation(conversationId: number) {
    return service.delete(`/chat/conversations/${conversationId}`)
  },
  
  // è·å–æ¶ˆæ¯åˆ—è¡¨
  getMessages(conversationId: number, params?: { page?: number; size?: number }) {
    return service.get(`/chat/conversations/${conversationId}/messages`, { params })
  },
  
  // å‘é€æ¶ˆæ¯
  sendMessage(data: ChatRequest) {
    return service.post<ChatResponse>('/chat/message', data)
  }
}
```

## 7. è·¯ç”±é…ç½®

### 7.1 è·¯ç”±å®šä¹‰ (router/index.ts)

```typescript
import { createRouter, createWebHistory } from 'vue-router'
import { useUserStore } from '@/stores/user'
import type { RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Layout',
    component: () => import('@/layouts/DefaultLayout.vue'),
    redirect: '/chat',
    children: [
      {
        path: 'chat',
        name: 'Chat',
        component: () => import('@/views/Chat.vue'),
        meta: {
          title: 'æ™ºèƒ½é—®ç­”',
          requiresAuth: true
        }
      },
      {
        path: 'knowledge',
        name: 'Knowledge',
        component: () => import('@/views/Knowledge.vue'),
        meta: {
          title: 'çŸ¥è¯†åº“ç®¡ç†',
          requiresAuth: true,
          requiresAdmin: true
        }
      },
      {
        path: 'settings',
        name: 'Settings',
        component: () => import('@/views/Settings.vue'),
        meta: {
          title: 'ç³»ç»Ÿè®¾ç½®',
          requiresAuth: true,
          requiresAdmin: true
        }
      }
    ]
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/Login.vue'),
    meta: {
      title: 'ç™»å½•',
      requiresGuest: true
    }
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/views/NotFound.vue'),
    meta: {
      title: 'é¡µé¢ä¸å­˜åœ¨'
    }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()
  const isAuthenticated = userStore.isAuthenticated
  const userRole = userStore.userInfo?.role
  
  // è®¾ç½®é¡µé¢æ ‡é¢˜
  if (to.meta.title) {
    document.title = `${to.meta.title} - ITçŸ¥è¯†é—®ç­”æœºå™¨äºº`
  }
  
  // éœ€è¦è®¤è¯ä½†æœªç™»å½•
  if (to.meta.requiresAuth && !isAuthenticated) {
    next('/login')
    return
  }
  
  // éœ€è¦ç®¡ç†å‘˜æƒé™
  if (to.meta.requiresAdmin && userRole !== 'ADMIN') {
    next('/')
    return
  }
  
  // å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µ
  if (to.meta.requiresGuest && isAuthenticated) {
    next('/')
    return
  }
  
  next()
})

export default router
```

## 8. æ ·å¼è®¾è®¡

### 8.1 å…¨å±€æ ·å¼ (styles/global.scss)

```scss
// å…¨å±€æ ·å¼
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
    'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial,
    sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
  background-color: #f5f7fa;
}

#app {
  height: 100vh;
  overflow: hidden;
}

// æ»šåŠ¨æ¡æ ·å¼
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
  
  &:hover {
    background: #a8a8a8;
  }
}

// å·¥å…·ç±»
.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.text-left {
  text-align: left;
}

.flex {
  display: flex;
}

.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-1 {
  flex: 1;
}

.mb-0 { margin-bottom: 0; }
.mb-8 { margin-bottom: 8px; }
.mb-16 { margin-bottom: 16px; }
.mb-24 { margin-bottom: 24px; }

.mt-0 { margin-top: 0; }
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mt-24 { margin-top: 24px; }

// å“åº”å¼éšè—
@media (max-width: 768px) {
  .mobile-hidden {
    display: none !important;
  }
}

@media (min-width: 769px) {
  .desktop-hidden {
    display: none !important;
  }
}
```

### 8.2 Element Plusä¸»é¢˜å®šåˆ¶ (styles/element-variables.scss)

```scss
// Element Plusä¸»é¢˜å˜é‡
$--color-primary: #409eff;
$--color-success: #67c23a;
$--color-warning: #e6a23c;
$--color-danger: #f56c6c;
$--color-info: #909399;

// è¦†ç›–Element Plusæ ·å¼
.el-button {
  border-radius: 6px;
}

.el-input__inner {
  border-radius: 6px;
}

.el-dialog {
  border-radius: 12px;
}

.el-card {
  border-radius: 8px;
}
```

## 9. æ€»ç»“

æœ¬å‰ç«¯è®¾è®¡æ–‡æ¡£è¯¦ç»†æè¿°äº†ITçŸ¥è¯†é—®ç­”æœºå™¨äººçš„å‰ç«¯æ¶æ„å’Œå®ç°æ–¹æ¡ˆ,åŒ…æ‹¬:

### æ ¸å¿ƒç‰¹æ€§
- âœ… **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: Vue 3 + TypeScript + Element Plus
- âœ… **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢ç«¯ã€å¹³æ¿ç«¯å’Œç§»åŠ¨ç«¯
- âœ… **ä¼˜é›…çš„UIç•Œé¢**: å€Ÿé‰´ä¸»æµèŠå¤©åº”ç”¨çš„è®¾è®¡æ¨¡å¼
- âœ… **å®æ—¶äº¤äº’**: WebSocketæ”¯æŒå®æ—¶æ¶ˆæ¯æ¨é€
- âœ… **æ¨¡å—åŒ–æ¶æ„**: ç»„ä»¶åŒ–å¼€å‘,æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### é¡µé¢åŠŸèƒ½
1. **èŠå¤©ä¸»é¡µé¢**: æ”¯æŒå¤šè½®å¯¹è¯ã€æ¶ˆæ¯å†å²ã€å¿«é€Ÿé—®é¢˜
2. **çŸ¥è¯†åº“ç®¡ç†**: æ–‡æ¡£ä¸Šä¼ ã€åˆ†ç±»ç®¡ç†ã€æœç´¢ç­›é€‰
3. **ç³»ç»Ÿè®¾ç½®**: é…ç½®ç®¡ç†ã€ç”¨æˆ·æƒé™ã€ç³»ç»Ÿç›‘æ§

### å¼€å‘ä¼˜åŠ¿
- å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- ç»Ÿä¸€çš„APIæ¥å£å°è£…å’Œé”™è¯¯å¤„ç†
- æ¨¡å—åŒ–çš„çŠ¶æ€ç®¡ç†
- è¯¦ç»†çš„è·¯ç”±å®ˆå«å’Œæƒé™æ§åˆ¶
- å®Œå–„çš„ç»„ä»¶æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

é€šè¿‡è¿™å¥—è®¾è®¡æ–¹æ¡ˆ,å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ç”¨æˆ·ä½“éªŒä¼˜ç§€çš„ITçŸ¥è¯†é—®ç­”ç³»ç»Ÿå‰ç«¯åº”ç”¨ã€‚
